# –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ –º–∞—Ä–æ–∫ —Å—Ç–∞–ª–∏ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é AI Search

**–î–∞—Ç–∞:** 2026-01-09
**–í–µ—Ä—Å–∏—è:** 1.0
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è + —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

---

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–ß–∞—Å—Ç—å 1: –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞](#—á–∞—Å—Ç—å-1-–∞–Ω–∞–ª–∏–∑-—Ç–µ–∫—É—â–µ–π-—Å–∏—Å—Ç–µ–º—ã-–ø–æ–∏—Å–∫–∞)
2. [–ß–∞—Å—Ç—å 2: –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ AI Search (–ö–†–ò–¢–ò–ß–ù–û)](#—á–∞—Å—Ç—å-2-–≥–ª—É–±–æ–∫–∏–π-–∞–Ω–∞–ª–∏–∑-ai-search-–∫—Ä–∏—Ç–∏—á–Ω–æ)
3. [–ß–∞—Å—Ç—å 3: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é](#—á–∞—Å—Ç—å-3-–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-–≤–Ω–µ–¥—Ä–µ–Ω–∏—é)

---

## –ß–∞—Å—Ç—å 1: –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞

### 1.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

#### –¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  –ë–ê–ó–ê –î–ê–ù–ù–´–• (SQLite)                        ‚îÇ
‚îÇ         database/steel_database.db (~8,691 –º–∞—Ä–æ–∫)           ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  –¢–∞–±–ª–∏—Ü—ã:                                                    ‚îÇ
‚îÇ  ‚Ä¢ steel_grades - –æ—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –º–∞—Ä–æ–∫                    ‚îÇ
‚îÇ  ‚Ä¢ ai_searches  - –∫—ç—à AI —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (TTL: 24 —á–∞—Å–∞)        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚îÇ
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              FLASK API (app.py) - –ø–æ—Ä—Ç 5001                 ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  Endpoints:                                                  ‚îÇ
‚îÇ  ‚Ä¢ GET  /api/steels          - –ø–æ–∏—Å–∫ + AI fallback         ‚îÇ
‚îÇ  ‚Ä¢ GET  /api/steels/ai-search - –ø—Ä—è–º–æ–π AI –ø–æ–∏—Å–∫            ‚îÇ
‚îÇ  ‚Ä¢ POST /api/steels/add       - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ë–î            ‚îÇ
‚îÇ  ‚Ä¢ POST /api/steels/delete    - —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î             ‚îÇ
‚îÇ  ‚Ä¢ GET  /api/stats            - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞                 ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  –ú–æ–¥—É–ª–∏:                                                     ‚îÇ
‚îÇ  ‚Ä¢ ai_search.py        - AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (Perplexity)        ‚îÇ
‚îÇ  ‚Ä¢ database_schema.py  - —Ä–∞–±–æ—Ç–∞ —Å –ë–î                        ‚îÇ
‚îÇ  ‚Ä¢ utils/pdf_parser.py - –ø–∞—Ä—Å–∏–Ω–≥ PDF —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–π          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                          ‚îÇ
         ‚Üì                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   TELEGRAM BOT      ‚îÇ   ‚îÇ   WEB –ò–ù–¢–ï–†–§–ï–ô–°         ‚îÇ
‚îÇ                     ‚îÇ   ‚îÇ                         ‚îÇ
‚îÇ ‚Ä¢ –ü–æ–∏—Å–∫ —á–µ—Ä–µ–∑ API   ‚îÇ   ‚îÇ ‚Ä¢ –¢–æ–ª—å–∫–æ –ë–î –ø–æ–∏—Å–∫       ‚îÇ
‚îÇ ‚Ä¢ AI –≤–∫–ª—é—á–µ–Ω (ai=true)‚îÇ  ‚îÇ ‚Ä¢ AI –æ—Ç–∫–ª—é—á–µ–Ω (—ç–∫–æ–Ω–æ–º–∏—è)‚îÇ
‚îÇ ‚Ä¢ Context Analyzer  ‚îÇ   ‚îÇ ‚Ä¢ –§–∏–ª—å—Ç—Ä—ã –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º  ‚îÇ
‚îÇ   (GPT-4 mini)      ‚îÇ   ‚îÇ ‚Ä¢ Exact Search (üîç)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

#### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite)**
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `database/steel_database.db`
- **–†–∞–∑–º–µ—Ä –±–∞–∑—ã:** ~8,691 –º–∞—Ä–æ–∫ —Å—Ç–∞–ª–∏
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã `steel_grades`:**
  - ID, grade (–Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ä–∫–∏)
  - base (Fe, Ni, Co, Ti)
  - –•–∏–º–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã: c, cr, mo, v, w, co, ni, mn, si, s, p, cu, nb, n
  - standard, manufacturer, analogues, tech (–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ), link

**2. Flask API (app.py)**
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å AI Search –º–æ–¥—É–ª–µ–º
- RESTful endpoints

**3. AI Search –º–æ–¥—É–ª—å (ai_search.py)**
- **–ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –º–æ–¥–µ–ª—å:** Perplexity Sonar-Pro (—Ç–æ–ª—å–∫–æ)
- **OpenAI —É–¥–∞–ª–µ–Ω:** –î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è 100% —Ç–æ—á–Ω–æ—Å—Ç–∏
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:** –û—Ç–∫–ª—é—á–µ–Ω–æ (–¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–∏—Å–∫–æ–≤ —Å —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏)

---

### 1.2 –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–∏—Å–∫ —Å–µ–π—á–∞—Å

#### 1.2.1 Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–û–±—ã—á–Ω—ã–π –ø–æ–∏—Å–∫ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π):**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: "K888"
   ‚Üì
[–ó–∞–¥–µ—Ä–∂–∫–∞ 1.5 —Å–µ–∫ –¥–ª—è debounce]
   ‚Üì
GET /api/steels?grade=K888
   ‚Üì
–ü–æ–∏—Å–∫ –≤ –ë–î (LIKE '%K888%')
   ‚Üì
–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
–ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ []
   ‚Üì
AI –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (—ç–∫–æ–Ω–æ–º–∏—è —Ç–æ–∫–µ–Ω–æ–≤)
```

**Exact Search (–∫–Ω–æ–ø–∫–∞ üîç):**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç: "K888"
–ù–∞–∂–∏–º–∞–µ—Ç: üîç
   ‚Üì
GET /api/steels?grade=K888&exact=true
   ‚Üì
–ü–æ–∏—Å–∫ –≤ –ë–î (WHERE grade = 'K888')
   ‚Üì
–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üí –ü—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤ []
   ‚Üì
AI –ù–ï –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è
```

**–§–∏–ª—å—Ç—Ä—ã –ø–æ —Ö–∏–º–∏—á–µ—Å–∫–æ–º—É —Å–æ—Å—Ç–∞–≤—É:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–¥–∞–µ—Ç:
  C: 0.4-0.5%
  Cr: 4.0-5.0%
   ‚Üì
GET /api/steels?c_min=0.4&c_max=0.5&cr_min=4.0&cr_max=5.0
   ‚Üì
SQL –∑–∞–ø—Ä–æ—Å —Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏
   ‚Üì
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ —Å–æ–≤–ø–∞–¥–∞—é—â–∏–µ –º–∞—Ä–∫–∏
```

**–í—ã–≤–æ–¥:** Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AI - —Ç–æ–ª—å–∫–æ –ø–æ–∏—Å–∫ –≤ –ë–î.

---

#### 1.2.2 Telegram Bot

**–õ—é–±–æ–π –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ –±–æ—Ç:**
```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç: "K888" –∏–ª–∏ "/search K888"
   ‚Üì
Context Analyzer (GPT-4 mini) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç intent
   ‚Üì
GET /api/steels?grade=K888&ai=true
   ‚Üì
–ü–æ–∏—Å–∫ –≤ –ë–î
   ‚Üì
–ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–∑ –ë–î
–ï—Å–ª–∏ –ù–ï –Ω–∞–π–¥–µ–Ω–æ ‚Üì
   ‚Üì
AI Search (Perplexity Sonar-Pro)
   ‚Üì
–ï—Å–ª–∏ AI –Ω–∞—à–µ–ª ‚Üí –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç + –∫–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ –ë–î"
–ï—Å–ª–∏ AI –ù–ï –Ω–∞—à–µ–ª ‚Üí –°–æ–æ–±—â–µ–Ω–∏–µ "–ù–µ –Ω–∞–π–¥–µ–Ω–æ"
```

**Context Analyzer (GPT-4 mini):**
- –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (search, analogues, stats, help)
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ä–∫–∏ –∏–∑ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞
- –ü—Ä–∏–º–µ—Ä—ã:
  - "–Ω–∞–π–¥–∏ 420" ‚Üí intent: search, grade: 420
  - "–∞–Ω–∞–ª–æ–≥–∏ D2" ‚Üí intent: analogues, grade: D2
  - "—á—Ç–æ —Ç–∞–∫–æ–µ Bohler K340" ‚Üí intent: search, grade: Bohler K340

**–í—ã–≤–æ–¥:** Telegram Bot –í–°–ï–ì–î–ê –∏—Å–ø–æ–ª—å–∑—É–µ—Ç AI fallback –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –º–∞—Ä–æ–∫.

---

### 1.3 –ê–Ω–∞–ª–∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞

#### 1.3.1 Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

‚úÖ **–ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –≤ –ë–î**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Å debounce 1.5 —Å–µ–∫
- –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–ª—è –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –º–∞—Ä–æ–∫
- –§–∏–ª—å—Ç—Ä—ã –ø–æ 14 —Ö–∏–º–∏—á–µ—Å–∫–∏–º —ç–ª–µ–º–µ–Ω—Ç–∞–º

‚úÖ **–≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤**
- AI –æ—Ç–∫–ª—é—á–µ–Ω ‚Üí –Ω–µ—Ç —Ä–∞—Å—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω–æ–≤
- –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

‚úÖ **–¢–æ—á–Ω—ã–π –ø–æ–∏—Å–∫ (üîç)**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–∞—Ä–∫–∏ –≤ –ë–î
- –ò—Å–∫–ª—é—á–∞–µ—Ç —á–∞—Å—Ç–∏—á–Ω—ã–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è

#### 1.3.2 Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

‚ùå **–ù–µ—Ç AI –ø–æ–∏—Å–∫–∞**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –Ω–∞–π—Ç–∏ –º–∞—Ä–∫–∏ –≤–Ω–µ –ë–î
- –ù–µ—Ç –ø–æ–¥—Å–∫–∞–∑–æ–∫ "–ø–æ–ø—Ä–æ–±—É–π—Ç–µ Telegram –±–æ—Ç"
- –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, —á—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –º–∞—Ä–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞

‚ùå **UX –ø—Ä–æ–±–ª–µ–º—ã:**
- –ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç [] - –Ω–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–µ–Ω
- –ù–µ—Ç –æ–±—ä—è—Å–Ω–µ–Ω–∏—è, –ø–æ—á–µ–º—É –º–∞—Ä–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
- –ù–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø—Ä–æ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –ø–æ–∏—Å–∫–∞

‚ùå **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ù–µ–ª—å–∑—è –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –º–∞—Ä–∫—É —á–µ—Ä–µ–∑ Web
- –ù–µ–ª—å–∑—è –∑–∞–ø—Ä–æ—Å–∏—Ç—å AI –ø–æ–∏—Å–∫ —è–≤–Ω–æ

---

#### 1.3.3 Telegram Bot - –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

‚úÖ **–£–º–Ω—ã–π AI fallback**
- Perplexity —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É
- –ù–∞—Ö–æ–¥–∏—Ç —Ä–µ–¥–∫–∏–µ –∏ —Ñ–∏—Ä–º–µ–Ω–Ω—ã–µ –º–∞—Ä–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

‚úÖ **Context Analyzer**
- –ü–æ–Ω–∏–º–∞–µ—Ç –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫
- –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∫–æ–º–∞–Ω–¥ (–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ)
- –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π handler

‚úÖ **–ë–æ–≥–∞—Ç—ã–π —Ñ–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞**
- –•–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤ —Å —Ä—É—Å—Å–∫–∏–º–∏ –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ê–Ω–∞–ª–æ–≥–∏, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ, —Å–≤–æ–π—Å—Ç–≤–∞
- –°—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- –ò–Ω–¥–∏–∫–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (AI vs –ë–î)

‚úÖ **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –ë–î**
- –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å –≤ –ë–î" (—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –∫–æ–¥–µ, –Ω–æ –∫–Ω–æ–ø–∫–∏ —É–±—Ä–∞–Ω—ã)
- –ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

#### 1.3.4 Telegram Bot - –°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

‚ùå **Context Analyzer –º–æ–∂–µ—Ç –æ—à–∏–±–∞—Ç—å—Å—è**
- GPT-4 mini –∏–Ω–æ–≥–¥–∞ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç intent
- –ü—Ä–∏–º–µ—Ä: "K888" –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ stats –∏–ª–∏ help

‚ùå **–ú–µ–¥–ª–µ–Ω–Ω—ã–π AI –ø–æ–∏—Å–∫**
- Perplexity: 15-30 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∑–∞–ø—Ä–æ—Å
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥–µ—Ç –±–µ–∑ –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- Timeout 60 —Å–µ–∫—É–Ω–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–µ–≤—ã—à–µ–Ω

‚ùå **–ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è**
- –ö–∞–∂–¥—ã–π –ø–æ–∏—Å–∫ = –Ω–æ–≤—ã–π API –∑–∞–ø—Ä–æ—Å –∫ Perplexity
- –†–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- (–ö—ç—à –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–æ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω—É–∂–µ–Ω)

‚ùå **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∞—è**
- –¢—Ä–µ–±—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ö–∏–º–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞
- –û—Ç–∫–ª–æ–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–∑ composition
- –ú–æ–∂–µ—Ç —É–ø—É—Å–∫–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–µ –º–∞—Ä–∫–∏ —Å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

---

### 1.4 –ü—Ä–æ–±–ª–µ–º—ã –∏ —É–∑–∫–∏–µ –º–µ—Å—Ç–∞

#### 1.4.1 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite):**
- ‚ö†Ô∏è –ù–µ—Ç timeout –¥–ª—è concurrent access ‚Üí `database is locked` –æ—à–∏–±–∫–∏
- ‚ö†Ô∏è –ù–µ—Ç WAL —Ä–µ–∂–∏–º–∞ ‚Üí –º–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å
- ‚ö†Ô∏è –ù–µ—Ç –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è (grade, base)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```python
# database_schema.py
def get_connection():
    conn = sqlite3.connect(config.DB_FILE, timeout=30.0)
    conn.execute("PRAGMA journal_mode=WAL")  # Write-Ahead Logging
    return conn
```

**AI Search:**
- ‚ö†Ô∏è Perplexity: 15-30 —Å–µ–∫ –Ω–∞ –∑–∞–ø—Ä–æ—Å (–º–µ–¥–ª–µ–Ω–Ω–æ)
- ‚ö†Ô∏è –ù–µ—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (sequential)
- ‚ö†Ô∏è –ù–µ—Ç streaming –æ—Ç–≤–µ—Ç–æ–≤ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∂–¥–µ—Ç –≤–µ—Å—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç)

---

#### 1.4.2 UI/UX –ø—Ä–æ–±–ª–µ–º—ã

**Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**

1. **–ü—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–µ–Ω**
   - –¢–µ–∫—É—â–µ–µ: `[]` (–ø—É—Å—Ç–æ–π –º–∞—Å—Å–∏–≤)
   - –ù—É–∂–Ω–æ: –°–æ–æ–±—â–µ–Ω–∏–µ "–ú–∞—Ä–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (8,691 –º–∞—Ä–æ–∫). –ü–æ–ø—Ä–æ–±—É–π—Ç–µ Telegram –±–æ—Ç –¥–ª—è AI –ø–æ–∏—Å–∫–∞."

2. **–ö–Ω–æ–ø–∫–∞ üîç –Ω–µ–ø–æ–Ω—è—Ç–Ω–∞**
   - –ù–µ—Ç –ø–æ–¥—Å–∫–∞–∑–∫–∏ (tooltip)
   - –ù–µ–ø–æ–Ω—è—Ç–Ω–æ, —á–µ–º –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

3. **–ù–µ—Ç –∏–Ω–¥–∏–∫–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏**
   - –ü—Ä–∏ –ø–æ–∏—Å–∫–µ –Ω–µ—Ç —Å–ø–∏–Ω–Ω–µ—Ä–∞
   - –ù–µ –≤–∏–¥–Ω–æ, —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

4. **–§–∏–ª—å—Ç—Ä—ã —Å–ª–æ–∂–Ω—ã –¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤**
   - –ù–µ—Ç –ø—Ä–∏–º–µ—Ä–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –ù–µ—Ç –ø—Ä–µ—Å–µ—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "–ù–µ—Ä–∂–∞–≤–µ—é—â–∏–µ —Å—Ç–∞–ª–∏", "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∞–ª–∏")

**Telegram Bot:**

1. **–î–æ–ª–≥–æ–µ –æ–∂–∏–¥–∞–Ω–∏–µ AI**
   - –ù–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞
   - –ù–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π ("–ò—â—É –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ...")

2. **Validation –æ—Ç–∫–ª–æ–Ω—è–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã**
   - –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ö–∏–º–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞
   - –ù–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å –ø–æ–º–µ—Ç–∫–æ–π "–Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ"

3. **–ö–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω—ã**
   - –†–∞–Ω—å—à–µ –±—ã–ª–∏ –∫–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å –≤ –ë–î" –∏ "–£–¥–∞–ª–∏—Ç—å"
   - –°–µ–π—á–∞—Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º

---

#### 1.4.3 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
   - `config.py` –≤ –∫–æ—Ä–Ω–µ
   - `telegram_bot/config.py` –æ—Ç–¥–µ–ª—å–Ω—ã–π
   - –ù—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é

2. **–ù–µ—Ç –µ–¥–∏–Ω–æ–≥–æ logging**
   - `print()` –≤–º–µ—Å—Ç–æ `logging`
   - –°–ª–æ–∂–Ω–æ –æ—Ç–ª–∞–¥–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

3. **–ñ–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**
   - Timeout 60 —Å–µ–∫ –≤ telegram bot
   - Debounce 1.5 —Å–µ–∫ –≤ Web
   - MAX_RESULTS_PER_MESSAGE = 5

4. **–ù–µ—Ç rate limiting**
   - AI Search –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞—Å–ø–∞–º–ª–µ–Ω
   - –ù–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

### 1.5 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é —Ç–µ–∫—É—â–µ–π —Å–∏—Å—Ç–µ–º—ã

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: UX —É–ª—É—á—à–µ–Ω–∏—è (–±—ã—Å—Ç—Ä–æ –≤–Ω–µ–¥—Ä–∏—Ç—å)

**Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**

1. **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ"**
```javascript
// templates/index.html
if (results.length === 0) {
    resultsDiv.innerHTML = `
        <div class="no-results">
            <h3>‚ùå –ú–∞—Ä–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h3>
            <p>–ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (8,691 –º–∞—Ä–æ–∫).</p>
            <p><strong>–•–æ—Ç–∏—Ç–µ –Ω–∞–π—Ç–∏ —Ä–µ–¥–∫–∏–µ –º–∞—Ä–∫–∏?</strong></p>
            <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ <a href="t.me/your_bot">Telegram –±–æ—Ç</a> —Å AI –ø–æ–∏—Å–∫–æ–º!</p>
        </div>
    `;
}
```

2. **Tooltip –¥–ª—è –∫–Ω–æ–ø–∫–∏ üîç**
```html
<button class="btn-exact-search"
        onclick="searchExact()"
        title="–¢–æ—á–Ω—ã–π –ø–æ–∏—Å–∫: –∏—â–µ—Ç —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –º–∞—Ä–∫–∏">
    üîç
</button>
```

3. **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏**
```javascript
function searchSteels(exactSearch = false) {
    resultsDiv.innerHTML = '<div class="loading">üîÑ –ü–æ–∏—Å–∫...</div>';
    // ... fetch ...
}
```

**Telegram Bot:**

1. **–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è**
```python
# telegram_bot/handlers/search.py
status_msg = await update.message.reply_text(
    f"üîç –ò—â—É –º–∞—Ä–∫—É `{grade_name}` –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö...",
    parse_mode='Markdown'
)

# –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –≤ –ë–î
await status_msg.edit_text(
    f"üîç –ú–∞—Ä–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –ë–î.\n"
    f"ü§ñ –ó–∞–ø—É—Å–∫–∞—é AI –ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Perplexity (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 20-30 —Å–µ–∫)...",
    parse_mode='Markdown'
)
```

2. **–ú–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**
```python
# ai_search.py
if not is_valid:
    # –í–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ–≥–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è
    result['validated'] = False
    result['warning'] = '–ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ - —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞'
    return result  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º
```

---

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

1. **–£–ª—É—á—à–∏—Ç—å database connection**
```python
# database_schema.py
def get_connection():
    conn = sqlite3.connect(config.DB_FILE, timeout=30.0)
    conn.execute("PRAGMA journal_mode=WAL")
    conn.execute("PRAGMA synchronous=NORMAL")
    conn.execute("PRAGMA cache_size=-64000")  # 64MB cache
    return conn
```

2. **–î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å—ã**
```python
# database_schema.py
def create_indexes():
    conn = get_connection()
    cursor = conn.cursor()
    cursor.execute("CREATE INDEX IF NOT EXISTS idx_grade ON steel_grades(grade)")
    cursor.execute("CREATE INDEX IF NOT EXISTS idx_base ON steel_grades(base)")
    cursor.execute("CREATE INDEX IF NOT EXISTS idx_standard ON steel_grades(standard)")
    conn.commit()
    conn.close()
```

3. **–í–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ AI (—Å TTL)**
```python
# ai_search.py
# –£–±—Ä–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ —Å –∫—ç—à–∞
cached_result = self._get_from_cache(grade_name)
if cached_result:
    return cached_result

# –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
self._save_to_cache(grade_name, result)
```

---

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

1. **–ï–¥–∏–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω config.py –∏–∑ –∫–æ—Ä–Ω—è
# telegram_bot/config.py -> –∏–º–ø–æ—Ä—Ç –∏–∑ –∫–æ—Ä–Ω—è
import sys
from pathlib import Path
sys.path.append(str(Path(__file__).parent.parent))
import config
```

2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π logging**
```python
# utils/logger.py
import logging

def get_logger(name):
    logger = logging.getLogger(name)
    logger.setLevel(logging.INFO)
    handler = logging.FileHandler('logs/parsersteel.log')
    formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
    handler.setFormatter(formatter)
    logger.addHandler(handler)
    return logger

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
# logger = get_logger(__name__)
# logger.info(f"Searching for {grade_name}")
```

3. **Rate limiting –¥–ª—è AI**
```python
# ai_search.py
from functools import lru_cache
from datetime import datetime, timedelta

class AISearch:
    def __init__(self):
        self.request_log = {}  # user_id: [timestamps]
        self.max_requests_per_hour = 20

    def check_rate_limit(self, user_id):
        now = datetime.now()
        hour_ago = now - timedelta(hours=1)

        if user_id not in self.request_log:
            self.request_log[user_id] = []

        # –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã
        self.request_log[user_id] = [
            ts for ts in self.request_log[user_id]
            if ts > hour_ago
        ]

        if len(self.request_log[user_id]) >= self.max_requests_per_hour:
            return False

        self.request_log[user_id].append(now)
        return True
```

---

### 1.6 –î–æ–ª–∂–Ω–∞ –ª–∏ —Å–∏—Å—Ç–µ–º–∞ –±—ã—Ç—å —É–ø—Ä–æ—â–µ–Ω–∞ –∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∞?

#### –í—ã–≤–æ–¥: –†–ê–°–®–ò–†–ï–ù–ê (–Ω–æ —Å —É–ø—Ä–æ—â–µ–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞)

**–ß—Ç–æ —É–ø—Ä–æ—Å—Ç–∏—Ç—å:**
- ‚ùå –£–±—Ä–∞—Ç—å Context Analyzer (GPT-4 mini) - —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–ª–æ—Ö–æ, –ª—É—á—à–µ —è–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
- ‚ùå –£–±—Ä–∞—Ç—å —Å—Ç—Ä–æ–≥—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é - –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏
- ‚ùå –£–ø—Ä–æ—Å—Ç–∏—Ç—å UI - –º–µ–Ω—å—à–µ –∫–Ω–æ–ø–æ–∫, –±–æ–ª—å—à–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–º–∞

**–ß—Ç–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å:**
- ‚úÖ Multi-agent AI Search (—Å–º. –ß–∞—Å—Ç—å 2)
- ‚úÖ –õ—É—á—à–∏–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è Perplexity
- ‚úÖ PDF/OCR –ø–∞—Ä—Å–∏–Ω–≥
- ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ Confidence scoring

**–ë–∞–ª–∞–Ω—Å:** –°–ª–æ–∂–Ω–∞—è AI –ª–æ–≥–∏–∫–∞ "–ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º" + –ø—Ä–æ—Å—Ç–æ–π UX –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

---

## –ß–∞—Å—Ç—å 2: –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ AI Search (–ö–†–ò–¢–ò–ß–ù–û)

### 2.1 –ü–æ—á–µ–º—É API Perplexity/OpenAI —Ö—É–∂–µ –≤–µ–±-–≤–µ—Ä—Å–∏–π?

#### –ü—Ä–æ–±–ª–µ–º–∞: API vs Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

**–ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∏–∑ –ø—Ä–∞–∫—Ç–∏–∫–∏:**
- Web Perplexity (perplexity.ai) –¥–∞–µ—Ç –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ –∏ –ø–æ–ª–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- API Perplexity (—á–µ—Ä–µ–∑ api.perplexity.ai) –∏–Ω–æ–≥–¥–∞ –¥–∞–µ—Ç –Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- OpenAI GPT-4 (—á–µ—Ä–µ–∑ API) –≤–æ–æ–±—â–µ –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É (—Ç–æ–ª—å–∫–æ –±–∞–∑–∞ –∑–Ω–∞–Ω–∏–π –¥–æ 2023)

**–ü—Ä–∏—á–∏–Ω—ã:**

1. **Web –≤–µ—Ä—Å–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –æ–±—Ä–∞–±–æ—Ç–∫—É**
   - Pre-processing –∑–∞–ø—Ä–æ—Å–æ–≤ (query expansion)
   - Post-processing —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (fact checking)
   - –í–∏–∑—É–∞–ª—å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ç–∞–±–ª–∏—Ü –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
   - –ë–æ–ª–µ–µ –≥–ª—É–±–æ–∫–∞—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

2. **API –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**
   - –ú–µ–Ω—å—à–µ tokens –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   - –ù–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —É—Ç–æ—á–Ω–µ–Ω–∏–π
   - –ú–µ–Ω—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –ø–æ–∏—Å–∫ (timeout)
   - –ú–µ–Ω—å—à–µ sources –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è

3. **–ü—Ä–æ–º–ø—Ç –∏–º–µ–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ**
   - Web UI –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –≥–æ–¥–∞–º–∏
   - API –ø—Ä–æ–º–ø—Ç –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞–º–∏ ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º
   - –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

---

### 2.2 –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

#### –¢–µ–∫—É—â–∏–π –ø—Ä–æ–º–ø—Ç (ai_search.py:440-501)

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
‚úÖ –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON
‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ö–∏–º–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞ (MANDATORY)
‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (manufacturer > standard > PDF)
‚úÖ –ó–∞–ø—Ä–µ—Ç –Ω–∞ –≤—ã–¥—É–º—ã–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ source_url
‚úÖ –ü–æ–ª—è –Ω–∞ —Ä—É—Å—Å–∫–æ–º (application, properties)

**–°–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**

‚ùå **1. –ù–µ—Ç —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**
```python
# –¢–µ–∫—É—â–µ–µ:
"Search MULTIPLE sources (manufacturer datasheets, MatWeb, steelnumber.com, standards)"

# –ù—É–∂–Ω–æ:
"Search sources in STRICT PRIORITY ORDER:
1. PRIORITY 1 (MOST RELIABLE): Manufacturer official datasheets (PDF)
2. PRIORITY 2: Official standards (AISI, DIN, GOST, JIS, etc.)
3. PRIORITY 3: Verified databases (MatWeb, steelnumber.com)
4. PRIORITY 4 (LEAST RELIABLE): General websites, forums
NEVER use Priority 4 sources for chemical composition."
```

‚ùå **2. –ù–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è cross-verification**
```python
# –¢–µ–∫—É—â–µ–µ:
"Cross-check chemical composition from at least 2 sources if possible"

# –ù—É–∂–Ω–æ:
"MANDATORY: Chemical composition MUST be verified from AT LEAST 2 independent sources.
If sources disagree:
- Use manufacturer datasheet as PRIMARY source
- Note discrepancy in 'validation_notes' field
- If difference > 5% for any element ‚Üí mark as 'requires_verification'"
```

‚ùå **3. –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–µ–æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ—Å—Ç–µ–π**
```python
# –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
"If multiple variants of the grade exist (e.g., K340 vs K340 ISOBLOC):
- Return the MOST COMMON variant
- Note other variants in 'analogues' field
- Specify which variant in 'grade' field"
```

‚ùå **4. –ù–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ citation/provenance**
```python
# –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
"For EACH piece of information, internally track which source it came from.
Priority of trust:
- Chemical composition: Manufacturer PDF > Standard > Database
- Analogues: Official standard > Manufacturer claim > Database
- Properties: Manufacturer > Technical database > General source"
```

‚ùå **5. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ä–µ–¥–∫–∏—Ö –º–∞—Ä–æ–∫**
```python
# –ù—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å:
"For proprietary/rare grades not in common databases:
1. Search manufacturer's website FIRST
2. Look for PDF datasheets (product_name.pdf, technical_datasheet.pdf)
3. If PDF found, extract composition from tables (look for 'Chemical Composition', 'Analysis', 'Typical')
4. If no PDF, search for HTML tables on manufacturer product pages
5. As last resort, use secondary databases (but mark as 'low_confidence')"
```

---

### 2.3 Multi-Agent –ø–æ–¥—Ö–æ–¥ - —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### –ö–æ–Ω—Ü–µ–ø—Ü–∏—è: –¶–µ–ø–æ—á–∫–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤

–í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç–æ–≤, –∫–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–µ–π –∑–∞–¥–∞—á–µ–π.

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   –ê–ì–ï–ù–¢ 1: –ò–°–¢–û–ß–ù–ò–ö–ò                         ‚îÇ
‚îÇ        –ó–∞–¥–∞—á–∞: –ù–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏                   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
                [–°–ø–∏—Å–æ–∫ URL + –æ—Ü–µ–Ω–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏]
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              –ê–ì–ï–ù–¢ 2: –ò–ó–í–õ–ï–ß–ï–ù–ò–ï –î–ê–ù–ù–´–•                      ‚îÇ
‚îÇ     –ó–∞–¥–∞—á–∞: –ò–∑–≤–ª–µ—á—å —Ö–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤ –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
          [Composition –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞]
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               –ê–ì–ï–ù–¢ 3: –í–ï–†–ò–§–ò–ö–ê–¶–ò–Ø                           ‚îÇ
‚îÇ  –ó–∞–¥–∞—á–∞: –°—Ä–∞–≤–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ, –≤—ã–±—Ä–∞—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
           [Verified composition + confidence]
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              –ê–ì–ï–ù–¢ 4: –ê–ù–ê–õ–û–ì–ò                                ‚îÇ
‚îÇ  –ó–∞–¥–∞—á–∞: –ù–∞–π—Ç–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–æ–≥–∏ –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
        [Analogues: –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ + –ø–æ —Å–æ—Å—Ç–∞–≤—É]
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ            –ê–ì–ï–ù–¢ 5: –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï                           ‚îÇ
‚îÇ   –ó–∞–¥–∞—á–∞: –°–æ–±—Ä–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π JSON + confidence scores        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
                  [Final Result]
```

---

#### –ê–≥–µ–Ω—Ç 1: Source Finder (–ü–æ–∏—Å–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤)

**–ó–∞–¥–∞—á–∞:** –ù–∞–π—Ç–∏ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –∏ –Ω–∞–¥–µ–∂–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è –º–∞—Ä–∫–∏ —Å—Ç–∞–ª–∏.

**–ü—Ä–æ–º–ø—Ç:**
```python
def agent_1_find_sources(grade_name: str) -> List[Dict]:
    prompt = f"""You are a source verification agent for steel grade databases.

Task: Find reliable sources for steel grade "{grade_name}".

PRIORITY ORDER (search in this order):
1. Manufacturer official website (e.g., bohler-edelstahl.com, uddeholm.com)
2. PDF datasheets from manufacturer
3. Official standards (AISI, DIN, GOST, JIS, EN, etc.)
4. Verified databases (MatWeb, steelnumber.com, azom.com)
5. Academic/technical papers

For EACH source found, return:
{{
  "url": "full URL",
  "type": "manufacturer_pdf | manufacturer_web | standard | database | paper",
  "reliability": "high | medium | low",
  "found_composition": true/false,
  "found_analogues": true/false,
  "notes": "brief description of what this source contains"
}}

Return JSON array of sources, ordered by reliability (highest first).
MAXIMUM 5 sources.

Example:
[
  {{
    "url": "https://www.bohler-edelstahl.com/app/uploads/sites/248/productdb/api/k888-matrix_en_gb.pdf",
    "type": "manufacturer_pdf",
    "reliability": "high",
    "found_composition": true,
    "found_analogues": true,
    "notes": "Official Bohler K888 MATRIX datasheet with full composition table"
  }},
  ...
]
"""
    # Call Perplexity with this prompt
    # Return parsed sources
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞ –ø–æ–∏—Å–∫–µ (–Ω–µ –æ—Ç–≤–ª–µ–∫–∞–µ—Ç—Å—è –Ω–∞ extraction)
- –û—Ü–µ–Ω–∫–∞ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ –∑–∞—Ä–∞–Ω–µ–µ
- –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –ª—É—á—à–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

---

#### –ê–≥–µ–Ω—Ç 2: Data Extractor (–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)

**–ó–∞–¥–∞—á–∞:** –ò–∑–≤–ª–µ—á—å —Ö–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞.

**–ü—Ä–æ–º–ø—Ç:**
```python
def agent_2_extract_composition(grade_name: str, source_url: str, source_type: str) -> Dict:
    prompt = f"""You are a data extraction agent specialized in steel chemical composition.

Steel grade: "{grade_name}"
Source URL: {source_url}
Source type: {source_type}

Task: Extract ONLY the chemical composition from this source.

EXTRACTION RULES:
1. Look for tables with headers: "Chemical Composition", "Analysis", "Typical Composition", "Nominal"
2. Extract values for these elements (if present):
   C, Cr, Ni, Mo, V, W, Co, Mn, Si, S, P, Cu, Nb, N, Ti, Al
3. Values can be:
   - Single value: "0.90" ‚Üí return as "0.90"
   - Range: "0.85-0.95" ‚Üí return as "0.85-0.95"
   - Max value: "max 0.03" ‚Üí return as "0.03" (note "max" in separate field)
4. NEVER invent or estimate values
5. If element not found ‚Üí return null

Return JSON:
{{
  "source_url": "{source_url}",
  "composition": {{
    "c": "value or null",
    "cr": "value or null",
    ...
  }},
  "extraction_confidence": "high | medium | low",
  "extraction_notes": "e.g., 'Extracted from Table 1 on page 2'"
}}

If composition not found in this source, return:
{{
  "source_url": "{source_url}",
  "composition": null,
  "extraction_confidence": "none",
  "extraction_notes": "Chemical composition not found in this source"
}}
"""
    # Call AI with this prompt
    # Return extracted composition
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –§–æ–∫—É—Å —Ç–æ–ª—å–∫–æ –Ω–∞ extraction (–Ω–µ –æ—Ç–≤–ª–µ–∫–∞–µ—Ç—Å—è –Ω–∞ –ø–æ–∏—Å–∫)
- –û—Ç–¥–µ–ª—å–Ω—ã–π confidence –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏—Å—Ç–æ—á–Ω–∏–∫–∞
- –ú–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä–∞–ª–ª–µ–ª–∏—Ç—å –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

---

#### –ê–≥–µ–Ω—Ç 3: Verifier (–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è)

**–ó–∞–¥–∞—á–∞:** –°—Ä–∞–≤–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∏ –≤—ã–±—Ä–∞—Ç—å –Ω–∞–∏–±–æ–ª–µ–µ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ.

**–ü—Ä–æ–º–ø—Ç:**
```python
def agent_3_verify_composition(grade_name: str, extractions: List[Dict]) -> Dict:
    prompt = f"""You are a verification agent for steel composition data.

Steel grade: "{grade_name}"

You have extracted composition from {len(extractions)} sources:
{json.dumps(extractions, indent=2)}

Task: Determine the MOST RELIABLE composition.

VERIFICATION RULES:
1. If multiple sources agree (within 5% tolerance) ‚Üí HIGH confidence
2. If sources disagree:
   - Prioritize: manufacturer_pdf > standard > database
   - Note discrepancy in validation_notes
   - Confidence = MEDIUM
3. If only 1 source ‚Üí MEDIUM confidence
4. For EACH element, choose the value from the highest-reliability source

Return JSON:
{{
  "composition": {{
    "c": "chosen value",
    "cr": "chosen value",
    ...
  }},
  "confidence_scores": {{
    "c": "high | medium | low",
    "cr": "high | medium | low",
    ...
  }},
  "overall_confidence": "high | medium | low",
  "validation_notes": [
    "C: 3 sources agree (0.90-0.95)",
    "Cr: Discrepancy found - manufacturer: 4.0-5.0%, database: 4.5-5.5%"
  ],
  "sources_used": [
    "manufacturer_pdf: https://...",
    "database: https://..."
  ]
}}

MANDATORY: Return composition ONLY if at least 3 major elements (C, Cr, Mo, V, W, Co, Ni) are found.
If not enough data ‚Üí return null.
"""
    # Call AI with this prompt
    # Return verified composition with confidence scores
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- Cross-verification –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è
- Confidence scores –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞
- –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (validation_notes)

---

#### –ê–≥–µ–Ω—Ç 4: Analogues Finder (–ü–æ–∏—Å–∫ –∞–Ω–∞–ª–æ–≥–æ–≤)

**–ó–∞–¥–∞—á–∞:** –ù–∞–π—Ç–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–æ–≥–∏ –∏ –∞–Ω–∞–ª–æ–≥–∏ –ø–æ —Ö–∏–º–∏—á–µ—Å–∫–æ–º—É —Å–æ—Å—Ç–∞–≤—É.

**–ü—Ä–æ–º–ø—Ç:**
```python
def agent_4_find_analogues(grade_name: str, composition: Dict, standard: str) -> Dict:
    prompt = f"""You are an analogues finder agent for steel grades.

Steel grade: "{grade_name}"
Standard: {standard}
Chemical composition:
{json.dumps(composition, indent=2)}

Task: Find analogues (equivalent grades).

ANALOGUES PRIORITY:
1. OFFICIAL ANALOGUES (highest priority):
   - From official standards (AISI, DIN, JIS, GOST)
   - From manufacturer documentation
   - Explicitly stated as "equivalent to..."

2. COMPOSITION-BASED ANALOGUES (fallback):
   - Grades with similar composition (¬±10% for each element)
   - Must have at least 70% match of major elements

Return JSON:
{{
  "official_analogues": [
    {{
      "grade": "AISI D2",
      "standard": "AISI",
      "source": "ISO 4957:2018 equivalence table",
      "confidence": "high"
    }},
    ...
  ],
  "composition_based_analogues": [
    {{
      "grade": "1.2379",
      "standard": "DIN",
      "match_percentage": 85,
      "source": "composition comparison",
      "confidence": "medium"
    }},
    ...
  ],
  "analogues_string": "AISI D2, DIN 1.2379, JIS SKD11 (official); X155CrVMo12-1 (by composition)"
}}

IMPORTANT: Separate official analogues from composition-based ones.
Mark confidence for each analogue.
"""
    # Call AI with this prompt
    # Return analogues with priority separation
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –∏ —Ä–∞—Å—á–µ—Ç–Ω—ã—Ö –∞–Ω–∞–ª–æ–≥–æ–≤
- Confidence scores
- –ú–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ-—Ä–∞–∑–Ω–æ–º—É –≤ UI

---

#### –ê–≥–µ–Ω—Ç 5: Formatter (–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

**–ó–∞–¥–∞—á–∞:** –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π JSON —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏.

```python
def agent_5_format_result(grade_name: str,
                          verified_composition: Dict,
                          analogues: Dict,
                          sources: List[Dict]) -> Dict:
    """
    –°–±–æ—Ä–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Å:
    - Verified composition
    - Confidence scores
    - Analogues (official vs composition-based)
    - Source provenance
    - Validation notes
    """
    return {
        "grade": grade_name,
        "found": True,
        "composition": verified_composition['composition'],
        "confidence_scores": verified_composition['confidence_scores'],
        "overall_confidence": verified_composition['overall_confidence'],
        "analogues_official": analogues['official_analogues'],
        "analogues_composition": analogues['composition_based_analogues'],
        "analogues": analogues['analogues_string'],
        "sources": sources,
        "validation_notes": verified_composition['validation_notes'],
        "timestamp": datetime.now().isoformat(),
        "agent_version": "multi-agent-v1"
    }
```

---

### 2.4 –°–∏—Å—Ç–µ–º–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

#### –ò–µ—Ä–∞—Ä—Ö–∏—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏

```
TIER 1 (100% –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å):
‚îú‚îÄ‚îÄ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ PDF —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
‚îÇ   ‚îî‚îÄ‚îÄ –ü—Ä–∏–º–µ—Ä—ã: bohler-edelstahl.com/products/*.pdf
‚îÇ               uddeholm.com/app/uploads/sites/.../*.pdf
‚îÇ
‚îî‚îÄ‚îÄ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã (ISO, AISI, DIN, GOST, JIS)
    ‚îî‚îÄ‚îÄ –ü—Ä–∏–º–µ—Ä—ã: ISO 4957:2018, AISI tool steel standards

TIER 2 (90-95% –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å):
‚îú‚îÄ‚îÄ –°—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è (HTML)
‚îÇ   ‚îî‚îÄ‚îÄ –¢–∞–±–ª–∏—Ü—ã –Ω–∞ —Å–∞–π—Ç–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
‚îÇ
‚îî‚îÄ‚îÄ –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    ‚îî‚îÄ‚îÄ MatWeb, steelnumber.com, azom.com

TIER 3 (70-80% –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å):
‚îú‚îÄ‚îÄ –ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–µ —Å—Ç–∞—Ç—å–∏ / –Ω–∞—É—á–Ω—ã–µ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ –û—Ç—Ä–∞—Å–ª–µ–≤—ã–µ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏

TIER 4 (–ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è composition):
‚îú‚îÄ‚îÄ –§–æ—Ä—É–º—ã, –±–ª–æ–≥–∏
‚îî‚îÄ‚îÄ –û–±—â–∏–µ –≤–µ–±-—Å–∞–π—Ç—ã
```

#### –ü—Ä–∞–≤–∏–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

1. **–•–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤:** –¢–û–õ–¨–ö–û TIER 1-2
2. **–ê–Ω–∞–ª–æ–≥–∏:** TIER 1-3 (—Å –ø–æ–º–µ—Ç–∫–æ–π confidence)
3. **–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ/—Å–≤–æ–π—Å—Ç–≤–∞:** TIER 1-3 (–º–æ–∂–Ω–æ TIER 4 —Å –ø–æ–º–µ—Ç–∫–æ–π)

#### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è

```python
class SourcePrioritySystem:
    TIER_1 = ["manufacturer_pdf", "official_standard"]
    TIER_2 = ["manufacturer_web", "verified_database"]
    TIER_3 = ["academic_paper", "industry_handbook"]
    TIER_4 = ["forum", "blog", "general_website"]

    def get_tier(self, source_type: str) -> int:
        if source_type in self.TIER_1:
            return 1
        elif source_type in self.TIER_2:
            return 2
        elif source_type in self.TIER_3:
            return 3
        else:
            return 4

    def is_valid_for_composition(self, source_type: str) -> bool:
        return self.get_tier(source_type) <= 2

    def get_confidence(self, source_type: str, agreement_count: int) -> str:
        tier = self.get_tier(source_type)

        if tier == 1 and agreement_count >= 2:
            return "high"
        elif tier <= 2 and agreement_count >= 1:
            return "medium"
        else:
            return "low"
```

---

### 2.5 OCR/PDF/Image Recognition —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### 2.5.1 PDF –ü–∞—Ä—Å–∏–Ω–≥

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ú–æ–¥—É–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: `utils/pdf_parser.py`
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç pdfplumber (–æ—Å–Ω–æ–≤–Ω–æ–π) + PyPDF2 (fallback)
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω —Å AI Search
- ‚ö†Ô∏è –ü–∞—Ä—Å–∏—Ç —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ 5 —Å—Ç—Ä–∞–Ω–∏—Ü
- ‚ö†Ô∏è –ù–µ—Ç OCR –¥–ª—è —Å–∫–∞–Ω–æ–≤

**–£–ª—É—á—à–µ–Ω–∏—è:**

1. **–†–∞—Å—à–∏—Ä–∏—Ç—å –ø–∞—Ä—Å–∏–Ω–≥**
```python
# utils/pdf_parser.py
def extract_text_pdfplumber(self, pdf_path: str, max_pages: int = 10) -> Optional[str]:
    """Extract from first 10 pages (not 5)"""
    with pdfplumber.open(pdf_path) as pdf:
        # –ò—â–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å "Chemical Composition"
        for i, page in enumerate(pdf.pages[:max_pages]):
            text = page.extract_text()
            if 'chemical composition' in text.lower() or 'analysis' in text.lower():
                # –ò–∑–≤–ª–µ—á—å —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É + —Å–ª–µ–¥—É—é—â—É—é
                return '\n\n'.join([
                    pdf.pages[i].extract_text(),
                    pdf.pages[min(i+1, len(pdf.pages)-1)].extract_text()
                ])
```

2. **–¢–∞–±–ª–∏—Ü—ã**
```python
def extract_tables(self, pdf_path: str) -> List[List[List[str]]]:
    """Extract all tables from PDF"""
    tables = []
    with pdfplumber.open(pdf_path) as pdf:
        for page in pdf.pages[:10]:
            page_tables = page.extract_tables()
            if page_tables:
                tables.extend(page_tables)
    return tables

def find_composition_table(self, tables: List) -> Optional[Dict]:
    """Find table with chemical composition"""
    for table in tables:
        # –ò—â–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏: C, Cr, Mo, V, W, ...
        if self._is_composition_table(table):
            return self._parse_composition_table(table)
    return None
```

---

#### 2.5.2 OCR –¥–ª—è —Å–∫–∞–Ω–æ–≤ PDF

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ PDF - —ç—Ç–æ —Å–∫–∞–Ω—ã (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è), pdfplumber –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å OCR —á–µ—Ä–µ–∑ Tesseract –∏–ª–∏ Azure/AWS OCR.

```python
# utils/ocr_parser.py
import pytesseract
from PIL import Image
import pdf2image

class OCRParser:
    def __init__(self):
        # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Tesseract
        pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'

    def pdf_to_images(self, pdf_path: str) -> List[Image.Image]:
        """Convert PDF pages to images"""
        images = pdf2image.convert_from_path(pdf_path, dpi=300)
        return images[:10]  # First 10 pages

    def extract_text_from_image(self, image: Image.Image) -> str:
        """Extract text using OCR"""
        # –ü—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –ª—É—á—à–µ–≥–æ OCR
        image = image.convert('L')  # Grayscale
        text = pytesseract.image_to_string(image, lang='eng')
        return text

    def extract_from_scanned_pdf(self, pdf_path: str) -> str:
        """Full pipeline: PDF ‚Üí Images ‚Üí OCR ‚Üí Text"""
        images = self.pdf_to_images(pdf_path)
        texts = []
        for img in images:
            text = self.extract_text_from_image(img)
            if 'chemical' in text.lower() or 'composition' in text.lower():
                texts.append(text)
        return '\n\n'.join(texts)
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
```python
# utils/pdf_parser.py
def extract_text(self, pdf_path: str) -> str:
    # Try pdfplumber first
    text = self.extract_text_pdfplumber(pdf_path)

    if not text or len(text) < 100:
        # Fallback to OCR
        print("PDF appears to be scanned, using OCR...")
        ocr = OCRParser()
        text = ocr.extract_from_scanned_pdf(pdf_path)

    return text
```

---

#### 2.5.3 Image Recognition (—Ñ–æ—Ç–æ —Å–ø–µ–∫—Ç—Ä–æ–º–µ—Ç—Ä–∞)

**Use Case:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–ø–µ–∫—Ç—Ä–æ–º–µ—Ç—Ä–∞ ‚Üí —Å–∏—Å—Ç–µ–º–∞ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç —Ö–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤.

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è:** Azure Computer Vision –∏–ª–∏ GPT-4 Vision API.

```python
# utils/spectrometer_ocr.py
from openai import OpenAI

class SpectrometerOCR:
    def __init__(self, api_key: str):
        self.client = OpenAI(api_key=api_key)

    def analyze_spectrometer_image(self, image_path: str) -> Dict:
        """
        Analyze spectrometer readout image using GPT-4 Vision
        """
        import base64

        # Encode image
        with open(image_path, 'rb') as f:
            image_data = base64.b64encode(f.read()).decode()

        prompt = """Analyze this spectrometer readout image.

Extract chemical composition values for these elements:
C, Cr, Ni, Mo, V, W, Co, Mn, Si, S, P, Cu, Nb, N

Return JSON:
{
  "composition": {
    "c": "value in %",
    "cr": "value in %",
    ...
  },
  "confidence": "high | medium | low",
  "notes": "any observations"
}

If you cannot read some values clearly, set them to null.
"""

        response = self.client.chat.completions.create(
            model="gpt-4-vision-preview",
            messages=[
                {
                    "role": "user",
                    "content": [
                        {"type": "text", "text": prompt},
                        {
                            "type": "image_url",
                            "image_url": {
                                "url": f"data:image/jpeg;base64,{image_data}"
                            }
                        }
                    ]
                }
            ],
            max_tokens=1000
        )

        # Parse response
        result = json.loads(response.choices[0].message.content)
        return result
```

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram Bot:**
```python
# telegram_bot/handlers/photo.py
async def handle_photo(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """Handle spectrometer photo"""
    photo = update.message.photo[-1]  # Largest size
    file = await photo.get_file()

    # Download
    photo_path = f"/tmp/{photo.file_id}.jpg"
    await file.download_to_drive(photo_path)

    # Analyze
    await update.message.reply_text("üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é —Ñ–æ—Ç–æ —Å–ø–µ–∫—Ç—Ä–æ–º–µ—Ç—Ä–∞...")

    ocr = SpectrometerOCR(api_key=os.getenv('OPENAI_API_KEY'))
    result = ocr.analyze_spectrometer_image(photo_path)

    # Search for matching grades
    # ...
```

---

### 2.6 –•–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤ - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (–ø–µ—Ä–≤–∏—á–Ω–∞—è —Ü–µ–ª—å)

#### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ö–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤ –¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω –∏ –ø–æ–ª–æ–Ω.

**–ö—Ä–∏—Ç–µ—Ä–∏–∏:**

1. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —ç–ª–µ–º–µ–Ω—Ç–æ–≤:**
   - –î–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö —Å—Ç–∞–ª–µ–π: C, Cr, Mo, V (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - –î–ª—è –Ω–µ—Ä–∂–∞–≤–µ—é—â–∏—Ö: C, Cr, Ni (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
   - –î–ª—è –±—ã—Å—Ç—Ä–æ—Ä–µ–∂—É—â–∏—Ö: C, Cr, Mo, V, W (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

2. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤:**
   - C: 0-5% (–æ–±—ã—á–Ω–æ 0.1-2.0% –¥–ª—è tool steels)
   - Cr: 0-30% (–æ–±—ã—á–Ω–æ 4-18%)
   - Ni: 0-20%
   - Mo: 0-10%
   - V: 0-5%
   - W: 0-20%

3. **Cross-verification:**
   - –ï—Å–ª–∏ 2+ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ ‚Üí —Å—Ä–∞–≤–Ω–∏—Ç—å
   - –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ >10% ‚Üí —Ñ–ª–∞–≥ "requires_verification"
   - –ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ >25% ‚Üí –æ—Ç–∫–ª–æ–Ω–∏—Ç—å

4. **–°—É–º–º–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤:**
   - Fe + C + Cr + Ni + Mo + ... –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å ‚âà 100%
   - –ï—Å–ª–∏ —Å—É–º–º–∞ < 95% –∏–ª–∏ > 105% ‚Üí —Ñ–ª–∞–≥ "incomplete_data"

---

#### –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

```python
class CompositionValidator:
    """Advanced composition validation"""

    REQUIRED_ELEMENTS = {
        'tool_steel': ['c', 'cr', 'mo', 'v'],
        'stainless': ['c', 'cr', 'ni'],
        'hsshigh_speed': ['c', 'cr', 'mo', 'v', 'w'],
        'default': ['c']  # At minimum
    }

    ELEMENT_RANGES = {
        'c': (0.0, 5.0),
        'cr': (0.0, 30.0),
        'ni': (0.0, 20.0),
        'mo': (0.0, 10.0),
        'v': (0.0, 5.0),
        'w': (0.0, 20.0),
        'co': (0.0, 15.0),
        'mn': (0.0, 2.0),
        'si': (0.0, 2.0),
    }

    def validate(self, composition: Dict, steel_type: str = 'default') -> Dict:
        """
        Comprehensive validation

        Returns:
        {
          "valid": True/False,
          "confidence": "high | medium | low",
          "issues": [],
          "warnings": []
        }
        """
        issues = []
        warnings = []

        # 1. Check required elements
        required = self.REQUIRED_ELEMENTS.get(steel_type, self.REQUIRED_ELEMENTS['default'])
        for elem in required:
            if elem not in composition or not composition[elem]:
                issues.append(f"Missing required element: {elem.upper()}")

        # 2. Validate ranges
        for elem, value in composition.items():
            if not value:
                continue

            try:
                # Parse range or single value
                if '-' in str(value):
                    min_val, max_val = map(float, str(value).split('-'))
                else:
                    min_val = max_val = float(value)

                # Check against expected range
                if elem in self.ELEMENT_RANGES:
                    expected_min, expected_max = self.ELEMENT_RANGES[elem]
                    if max_val > expected_max:
                        warnings.append(f"{elem.upper()}: {value}% exceeds typical range (max {expected_max}%)")
                    if min_val < 0:
                        issues.append(f"{elem.upper()}: negative value not allowed")

            except ValueError:
                issues.append(f"{elem.upper()}: invalid format '{value}'")

        # 3. Check sum (if Fe is present or can be inferred)
        total_sum = self._calculate_sum(composition)
        if total_sum > 105:
            warnings.append(f"Sum of elements ({total_sum}%) > 100% - possible error")
        elif total_sum < 95 and len(composition) > 5:
            warnings.append(f"Sum of elements ({total_sum}%) < 100% - incomplete data")

        # Determine validity and confidence
        valid = len(issues) == 0

        if valid and len(warnings) == 0:
            confidence = "high"
        elif valid and len(warnings) <= 2:
            confidence = "medium"
        else:
            confidence = "low"

        return {
            "valid": valid,
            "confidence": confidence,
            "issues": issues,
            "warnings": warnings,
            "element_count": len([v for v in composition.values() if v])
        }

    def cross_verify(self, compositions: List[Dict]) -> Dict:
        """
        Compare compositions from multiple sources
        """
        if len(compositions) < 2:
            return {"agreement": "single_source", "confidence": "medium"}

        # Compare each element across sources
        discrepancies = []
        agreements = []

        all_elements = set()
        for comp in compositions:
            all_elements.update(comp.keys())

        for elem in all_elements:
            values = []
            for comp in compositions:
                if elem in comp and comp[elem]:
                    # Parse to mid-range value
                    val_str = str(comp[elem])
                    if '-' in val_str:
                        min_v, max_v = map(float, val_str.split('-'))
                        values.append((min_v + max_v) / 2)
                    else:
                        values.append(float(val_str))

            if len(values) < 2:
                continue

            # Check agreement
            avg_val = sum(values) / len(values)
            max_diff = max(abs(v - avg_val) for v in values)
            percent_diff = (max_diff / avg_val * 100) if avg_val > 0 else 0

            if percent_diff > 25:
                discrepancies.append({
                    "element": elem,
                    "values": values,
                    "percent_diff": percent_diff,
                    "severity": "high"
                })
            elif percent_diff > 10:
                discrepancies.append({
                    "element": elem,
                    "values": values,
                    "percent_diff": percent_diff,
                    "severity": "medium"
                })
            else:
                agreements.append(elem)

        # Overall confidence
        if len(discrepancies) == 0:
            confidence = "high"
        elif len([d for d in discrepancies if d['severity'] == 'high']) > 0:
            confidence = "low"
        else:
            confidence = "medium"

        return {
            "agreement": "verified" if len(discrepancies) == 0 else "partial",
            "confidence": confidence,
            "agreements": agreements,
            "discrepancies": discrepancies,
            "source_count": len(compositions)
        }
```

---

### 2.7 –ê–Ω–∞–ª–æ–≥–∏ - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è (–≤—Ç–æ—Ä–∏—á–Ω–∞—è —Ü–µ–ª—å)

#### –ò–µ—Ä–∞—Ä—Ö–∏—è –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏ –∞–Ω–∞–ª–æ–≥–æ–≤

```
TIER 1: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –∞–Ω–∞–ª–æ–≥–∏ –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–≤
‚îú‚îÄ‚îÄ –¢–∞–±–ª–∏—Ü—ã —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –≤ ISO, DIN, AISI, GOST, JIS
‚îú‚îÄ‚îÄ –ü—Ä–∏–º–µ—Ä: ISO 4957:2018 - Table of equivalent grades
‚îî‚îÄ‚îÄ Confidence: HIGH (95-100%)

TIER 2: –ê–Ω–∞–ª–æ–≥–∏ –æ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
‚îú‚îÄ‚îÄ "This grade is equivalent to AISI D2"
‚îú‚îÄ‚îÄ –£–∫–∞–∑–∞–Ω–æ –Ω–∞ —Å–∞–π—Ç–µ/PDF –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—è
‚îî‚îÄ‚îÄ Confidence: HIGH (90-95%)

TIER 3: –ê–Ω–∞–ª–æ–≥–∏ –∏–∑ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ MatWeb, steelnumber.com —É–∫–∞–∑—ã–≤–∞—é—Ç equivalents
‚îî‚îÄ‚îÄ Confidence: MEDIUM (80-90%)

TIER 4: –ê–Ω–∞–ª–æ–≥–∏ –ø–æ —Ö–∏–º–∏—á–µ—Å–∫–æ–º—É —Å–æ—Å—Ç–∞–≤—É
‚îú‚îÄ‚îÄ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ –ø–æ composition match
‚îú‚îÄ‚îÄ Match > 90% ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –∞–Ω–∞–ª–æ–≥–æ–º
‚îî‚îÄ‚îÄ Confidence: MEDIUM (70-80%)

TIER 5: –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º—ã–µ –∞–Ω–∞–ª–æ–≥–∏
‚îú‚îÄ‚îÄ "Similar to...", "Comparable with..."
‚îî‚îÄ‚îÄ Confidence: LOW (50-70%)
```

---

#### –ê–ª–≥–æ—Ä–∏—Ç–º –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∞–Ω–∞–ª–æ–≥–æ–≤

```python
class AnaloguesVerifier:
    """Verify and rank analogues by confidence"""

    def verify_analogues(self,
                        grade_name: str,
                        composition: Dict,
                        analogues_list: List[str],
                        sources: List[Dict]) -> List[Dict]:
        """
        Verify each analogue and assign confidence

        Returns list of:
        {
          "grade": "AISI D2",
          "standard": "AISI",
          "confidence": "high",
          "verification_method": "official_standard",
          "source": "ISO 4957:2018",
          "composition_match": 95  # % match if verified by composition
        }
        """
        verified_analogues = []

        for analogue in analogues_list:
            verification = self._verify_single_analogue(
                grade_name,
                analogue,
                composition,
                sources
            )
            verified_analogues.append(verification)

        # Sort by confidence
        verified_analogues.sort(key=lambda x: self._confidence_score(x['confidence']), reverse=True)

        return verified_analogues

    def _verify_single_analogue(self,
                                grade_name: str,
                                analogue: str,
                                composition: Dict,
                                sources: List[Dict]) -> Dict:
        """Verify single analogue"""

        # Check if found in official standard
        for source in sources:
            if source['type'] == 'official_standard':
                if analogue in source['content']:
                    return {
                        "grade": analogue,
                        "confidence": "high",
                        "verification_method": "official_standard",
                        "source": source['url']
                    }

        # Check if mentioned by manufacturer
        for source in sources:
            if source['type'] in ['manufacturer_pdf', 'manufacturer_web']:
                if analogue in source['content']:
                    return {
                        "grade": analogue,
                        "confidence": "high",
                        "verification_method": "manufacturer_claim",
                        "source": source['url']
                    }

        # Check composition match
        analogue_composition = self._get_composition_from_db(analogue)
        if analogue_composition:
            match_percent = self._calculate_composition_match(composition, analogue_composition)

            if match_percent >= 90:
                return {
                    "grade": analogue,
                    "confidence": "medium",
                    "verification_method": "composition_match",
                    "composition_match": match_percent,
                    "source": "database_comparison"
                }
            elif match_percent >= 70:
                return {
                    "grade": analogue,
                    "confidence": "low",
                    "verification_method": "composition_similarity",
                    "composition_match": match_percent,
                    "source": "database_comparison"
                }

        # No verification possible
        return {
            "grade": analogue,
            "confidence": "unverified",
            "verification_method": "mentioned_only",
            "source": "ai_response"
        }

    def _calculate_composition_match(self, comp1: Dict, comp2: Dict) -> float:
        """
        Calculate % match between two compositions

        Algorithm:
        - For each major element (C, Cr, Mo, V, W, Co, Ni)
        - Calculate overlap of ranges
        - Weight by importance (C and Cr are most important)
        """
        weights = {
            'c': 0.25,
            'cr': 0.25,
            'mo': 0.15,
            'v': 0.10,
            'w': 0.10,
            'ni': 0.05,
            'co': 0.05,
            'mn': 0.03,
            'si': 0.02
        }

        total_score = 0
        total_weight = 0

        for elem, weight in weights.items():
            if elem not in comp1 or elem not in comp2:
                continue

            val1 = self._parse_value_range(comp1[elem])
            val2 = self._parse_value_range(comp2[elem])

            if not val1 or not val2:
                continue

            # Calculate overlap
            overlap = self._range_overlap(val1, val2)
            total_score += overlap * weight
            total_weight += weight

        if total_weight == 0:
            return 0

        return (total_score / total_weight) * 100

    def _range_overlap(self, range1: Tuple[float, float], range2: Tuple[float, float]) -> float:
        """Calculate overlap between two ranges (0-1)"""
        min1, max1 = range1
        min2, max2 = range2

        # Calculate overlap
        overlap_min = max(min1, min2)
        overlap_max = min(max1, max2)

        if overlap_max < overlap_min:
            # No overlap
            # Calculate distance
            if min1 > max2:
                distance = min1 - max2
            else:
                distance = min2 - max1

            avg_range = ((max1 - min1) + (max2 - min2)) / 2
            # Penalize by distance
            return max(0, 1 - (distance / avg_range))

        # Calculate overlap ratio
        overlap_size = overlap_max - overlap_min
        union_size = max(max1, max2) - min(min1, min2)

        return overlap_size / union_size if union_size > 0 else 0
```

---

### 2.8 Confidence/Reliability Scoring System

#### –ú–Ω–æ–≥–æ–º–µ—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—Ü–µ–Ω–∫–∏ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç–∏

**–§–∞–∫—Ç–æ—Ä—ã:**

1. **Source Reliability** (40%)
   - TIER 1 (manufacturer PDF, standard): 100%
   - TIER 2 (manufacturer web, database): 90%
   - TIER 3 (academic): 70%
   - TIER 4 (general): 50%

2. **Cross-verification** (30%)
   - 3+ sources agree: 100%
   - 2 sources agree: 80%
   - Single source: 50%

3. **Data Completeness** (20%)
   - All major elements present: 100%
   - Missing 1-2 elements: 80%
   - Missing 3+ elements: 50%

4. **Validation Passed** (10%)
   - All checks pass: 100%
   - Warnings only: 80%
   - Issues present: 50%

---

#### –†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ Confidence Score

```python
class ConfidenceScorer:
    """Calculate overall confidence score"""

    WEIGHTS = {
        'source_reliability': 0.40,
        'cross_verification': 0.30,
        'data_completeness': 0.20,
        'validation': 0.10
    }

    def calculate_confidence(self,
                            sources: List[Dict],
                            verification_result: Dict,
                            composition: Dict,
                            validation_result: Dict) -> Dict:
        """
        Calculate overall confidence score

        Returns:
        {
          "score": 0.85,  # 0-1
          "grade": "high",  # high/medium/low
          "breakdown": {
            "source_reliability": 0.90,
            "cross_verification": 0.80,
            "data_completeness": 0.85,
            "validation": 1.0
          }
        }
        """
        scores = {}

        # 1. Source Reliability
        scores['source_reliability'] = self._score_source_reliability(sources)

        # 2. Cross-verification
        scores['cross_verification'] = self._score_cross_verification(verification_result)

        # 3. Data Completeness
        scores['data_completeness'] = self._score_completeness(composition)

        # 4. Validation
        scores['validation'] = self._score_validation(validation_result)

        # Calculate weighted average
        total_score = sum(
            scores[key] * self.WEIGHTS[key]
            for key in scores.keys()
        )

        # Determine grade
        if total_score >= 0.85:
            grade = "high"
        elif total_score >= 0.70:
            grade = "medium"
        else:
            grade = "low"

        return {
            "score": round(total_score, 2),
            "grade": grade,
            "breakdown": scores,
            "description": self._describe_confidence(grade, scores)
        }

    def _score_source_reliability(self, sources: List[Dict]) -> float:
        """Score based on source quality"""
        if not sources:
            return 0.5

        # Find best source
        tier_scores = {
            'manufacturer_pdf': 1.0,
            'official_standard': 1.0,
            'manufacturer_web': 0.9,
            'verified_database': 0.9,
            'academic_paper': 0.7,
            'general': 0.5
        }

        best_score = max(tier_scores.get(s['type'], 0.5) for s in sources)
        return best_score

    def _score_cross_verification(self, verification_result: Dict) -> float:
        """Score based on cross-verification"""
        if verification_result.get('agreement') == 'verified':
            source_count = verification_result.get('source_count', 1)
            if source_count >= 3:
                return 1.0
            elif source_count == 2:
                return 0.8
            else:
                return 0.5
        elif verification_result.get('agreement') == 'partial':
            return 0.6
        else:
            return 0.5

    def _score_completeness(self, composition: Dict) -> float:
        """Score based on data completeness"""
        major_elements = ['c', 'cr', 'mo', 'v', 'w', 'co', 'ni']
        present = sum(1 for elem in major_elements if elem in composition and composition[elem])

        return min(1.0, present / 5)  # At least 5 elements for 100%

    def _score_validation(self, validation_result: Dict) -> float:
        """Score based on validation results"""
        if not validation_result.get('valid'):
            return 0.5

        confidence = validation_result.get('confidence', 'medium')
        if confidence == 'high':
            return 1.0
        elif confidence == 'medium':
            return 0.8
        else:
            return 0.6

    def _describe_confidence(self, grade: str, breakdown: Dict) -> str:
        """Human-readable confidence description"""
        if grade == "high":
            return "–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏–∑ –Ω–∞–¥–µ–∂–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å/—Å—Ç–∞–Ω–¥–∞—Ä—Ç), —Ö–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω"
        elif grade == "medium":
            return "–î–∞–Ω–Ω—ã–µ –∏–∑ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏"
        else:
            return "–î–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–ø–æ–ª–Ω—ã–º–∏ –∏–ª–∏ —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏–∑ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤"
```

---

### 2.9 –ò–Ω–¥–∏–∫–∞—Ü–∏—è –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### UI –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ Confidence

**Telegram Bot - —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è:**

```python
def format_steel_result_with_confidence(result: dict) -> str:
    """Enhanced formatting with confidence indicators"""

    lines = []

    # Header with confidence indicator
    grade = result.get('grade', 'N/A')
    confidence_score = result.get('confidence_score', {})
    confidence_grade = confidence_score.get('grade', 'medium')

    # Emoji indicators
    confidence_emoji = {
        'high': '‚úÖ',
        'medium': '‚ö†Ô∏è',
        'low': '‚ùì'
    }

    emoji = confidence_emoji.get(confidence_grade, '‚ö†Ô∏è')
    lines.append(f"{emoji} **–ú–∞—Ä–∫–∞: {grade}**")

    # Confidence score
    score = confidence_score.get('score', 0.0)
    lines.append(f"üìä **–î–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å:** {score*100:.0f}% ({confidence_grade.upper()})")
    lines.append("")

    # Description
    description = confidence_score.get('description', '')
    if description:
        lines.append(f"‚ÑπÔ∏è _{description}_")
        lines.append("")

    # Chemical composition with element-level confidence
    lines.append("**–•–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤:**")

    element_confidence = result.get('confidence_scores', {})
    elements = ['c', 'cr', 'mo', 'v', 'w', 'co', 'ni', 'mn', 'si']

    for elem in elements:
        value = result.get(elem)
        if value and value not in ['0', '0.00', None, 'null']:
            elem_conf = element_confidence.get(elem, 'medium')
            conf_indicator = confidence_emoji.get(elem_conf, '‚ö†Ô∏è')
            lines.append(f"  {conf_indicator} {elem.upper()}: {value}%")

    # Validation warnings
    if not result.get('validated', True):
        lines.append("")
        lines.append("‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:**")
        warnings = result.get('validation_warnings', [])
        for warning in warnings:
            lines.append(f"  ‚Ä¢ {warning}")

    # Source information
    sources = result.get('sources', [])
    if sources:
        lines.append("")
        lines.append("üìö **–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**")
        for source in sources[:3]:  # Top 3 sources
            source_type = source.get('type', 'unknown')
            reliability = source.get('reliability', 'unknown')
            url = source.get('url', '')

            lines.append(f"  ‚Ä¢ [{source_type}] {reliability.upper()}")
            if url:
                lines.append(f"    üîó {url[:50]}...")

    # Analogues with confidence
    analogues = result.get('analogues_verified', [])
    if analogues:
        lines.append("")
        lines.append("üîó **–ê–Ω–∞–ª–æ–≥–∏:**")

        # Group by confidence
        high_conf = [a for a in analogues if a['confidence'] == 'high']
        medium_conf = [a for a in analogues if a['confidence'] == 'medium']

        if high_conf:
            lines.append("  ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ:")
            for a in high_conf:
                lines.append(f"     ‚Ä¢ {a['grade']} ({a.get('verification_method', 'verified')})")

        if medium_conf:
            lines.append("  ‚ö†Ô∏è –ü–æ —Ö–∏–º–∏—á–µ—Å–∫–æ–º—É —Å–æ—Å—Ç–∞–≤—É:")
            for a in medium_conf:
                match = a.get('composition_match', 0)
                lines.append(f"     ‚Ä¢ {a['grade']} (—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: {match:.0f}%)")

    return '\n'.join(lines)
```

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**

```
‚úÖ **–ú–∞—Ä–∫–∞: Bohler K340**
üìä **–î–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å:** 92% (HIGH)

‚ÑπÔ∏è _–î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏–∑ –Ω–∞–¥–µ–∂–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å/—Å—Ç–∞–Ω–¥–∞—Ä—Ç), —Ö–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω_

**–•–∏–º–∏—á–µ—Å–∫–∏–π —Å–æ—Å—Ç–∞–≤:**
  ‚úÖ C: 1.50-1.60%
  ‚úÖ Cr: 11.0-12.0%
  ‚úÖ Mo: 0.70-0.80%
  ‚úÖ V: 0.90-1.00%
  ‚ö†Ô∏è Mn: 0.40%
  ‚ö†Ô∏è Si: 0.30%

üìö **–ò—Å—Ç–æ—á–Ω–∏–∫–∏:**
  ‚Ä¢ [manufacturer_pdf] HIGH
    üîó https://www.bohler-edelstahl.com/app/uploads/...
  ‚Ä¢ [verified_database] MEDIUM
    üîó https://www.matweb.com/...

üîó **–ê–Ω–∞–ª–æ–≥–∏:**
  ‚úÖ –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ:
     ‚Ä¢ AISI D2 (official_standard)
     ‚Ä¢ DIN 1.2379 (official_standard)
  ‚ö†Ô∏è –ü–æ —Ö–∏–º–∏—á–µ—Å–∫–æ–º—É —Å–æ—Å—Ç–∞–≤—É:
     ‚Ä¢ X155CrVMo12-1 (—Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ: 88%)
```

---

**Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å - –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã:**

```html
<!-- Confidence badge -->
<div class="result-card" data-confidence="high">
    <div class="confidence-badge high">
        <span class="confidence-icon">‚úì</span>
        <span class="confidence-text">92% –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å</span>
    </div>

    <h3 class="grade-name">Bohler K340</h3>

    <!-- Composition with per-element confidence -->
    <table class="composition-table">
        <tr class="element-row" data-confidence="high">
            <td class="element-name">
                <span class="confidence-dot green"></span>
                C
            </td>
            <td class="element-value">1.50-1.60%</td>
        </tr>
        <tr class="element-row" data-confidence="medium">
            <td class="element-name">
                <span class="confidence-dot yellow"></span>
                Mn
            </td>
            <td class="element-value">0.40%</td>
        </tr>
    </table>

    <!-- Sources expandable section -->
    <details class="sources-section">
        <summary>üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏ (3)</summary>
        <ul class="sources-list">
            <li class="source-item high-reliability">
                <span class="source-type">Manufacturer PDF</span>
                <span class="reliability-badge">HIGH</span>
                <a href="...">–°—Å—ã–ª–∫–∞</a>
            </li>
        </ul>
    </details>
</div>
```

**CSS:**
```css
.confidence-badge {
    display: inline-flex;
    align-items: center;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: bold;
}

.confidence-badge.high {
    background: #4caf50;
    color: white;
}

.confidence-badge.medium {
    background: #ff9800;
    color: white;
}

.confidence-badge.low {
    background: #f44336;
    color: white;
}

.confidence-dot {
    display: inline-block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-right: 6px;
}

.confidence-dot.green {
    background: #4caf50;
}

.confidence-dot.yellow {
    background: #ff9800;
}

.confidence-dot.red {
    background: #f44336;
}
```

---

### 2.10 –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –ø—Ä–æ–º–ø—Ç–æ–≤

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–ª—É—á—à–µ–Ω–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

```python
def create_enhanced_prompt(grade_name: str) -> str:
    return f"""You are an EXPERT steel metallurgist and data extraction specialist.

MISSION: Find VERIFIED chemical composition for steel grade "{grade_name}".

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
CRITICAL SEARCH PROTOCOL - FOLLOW STRICTLY
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

STEP 1: IDENTIFY SOURCE PRIORITY
Search in this EXACT order:

Priority 1 (STOP if found):
  ‚Ä¢ Manufacturer official datasheets (PDF format)
    Examples: bohler-edelstahl.com, uddeholm.com, voestalpine.com
  ‚Ä¢ Look for: product_name.pdf, technical_datasheet.pdf, material_datasheet.pdf

Priority 2 (if P1 not found):
  ‚Ä¢ Official standards documents
    Examples: ISO, AISI, DIN, GOST, JIS, EN standards
  ‚Ä¢ Look for: equivalence tables, composition tables

Priority 3 (if P1-P2 not found):
  ‚Ä¢ Verified technical databases
    ONLY: MatWeb.com, steelnumber.com, azom.com, totalmateria.com

Priority 4 (LAST RESORT):
  ‚Ä¢ Academic papers, industry handbooks
  ‚Ä¢ Mark as "medium confidence" if using this tier

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
STEP 2: EXTRACT COMPOSITION
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Look for tables with headers:
  ‚Ä¢ "Chemical Composition"
  ‚Ä¢ "Nominal Analysis"
  ‚Ä¢ "Typical Composition"
  ‚Ä¢ "Chemical Analysis"

Extract these elements (if present):
  C, Cr, Ni, Mo, V, W, Co, Mn, Si, S, P, Cu, Nb, N, Ti, Al

Format rules:
  ‚Ä¢ Range: "0.85-0.95" ‚Üí keep as is
  ‚Ä¢ Single value: "0.90" ‚Üí keep as is
  ‚Ä¢ Max value: "max 0.030" ‚Üí return "0.030" and note "max" separately
  ‚Ä¢ Typical: "typ. 0.90" ‚Üí return "0.90"

NEVER:
  ‚Ä¢ Estimate or calculate missing values
  ‚Ä¢ Use values from similar grades
  ‚Ä¢ Extrapolate from incomplete data

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
STEP 3: CROSS-VERIFICATION (if multiple sources found)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

If composition found in 2+ sources:
  1. Compare each element
  2. If difference < 5% ‚Üí HIGH confidence, use average
  3. If difference 5-10% ‚Üí MEDIUM confidence, use manufacturer value
  4. If difference > 10% ‚Üí Flag as "requires_verification", note discrepancy

Priority for conflict resolution:
  Manufacturer PDF > Standard > Database > Other

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
STEP 4: ANALOGUES (separate task)
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Find equivalents in this order:
  1. Official equivalence tables (ISO, standards)
  2. Manufacturer claims ("equivalent to...")
  3. Database equivalence listings

Format: "AISI D2, DIN 1.2379, JIS SKD11"
DO NOT include "similar" or "comparable" grades - only confirmed equivalents.

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
RETURN FORMAT
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Return ONLY valid JSON (no markdown, no explanations):

{{
  "grade": "{grade_name}",
  "found": true/false,

  // Chemical composition (MANDATORY if found=true)
  "composition": {{
    "c": "value or null",
    "cr": "value or null",
    "mo": "value or null",
    "v": "value or null",
    "w": "value or null",
    "co": "value or null",
    "ni": "value or null",
    "mn": "value or null",
    "si": "value or null",
    "s": "value or null",
    "p": "value or null",
    "cu": "value or null",
    "nb": "value or null",
    "n": "value or null"
  }},

  // Analogues (space-separated list)
  "analogues": "AISI D2 DIN 1.2379 JIS SKD11" or null,

  // Metadata
  "standard": "standard name or manufacturer name",
  "manufacturer": "manufacturer name if proprietary",
  "manufacturer_country": "country (in Russian: –ì–µ—Ä–º–∞–Ω–∏—è, –°–®–ê, –ê–≤—Å—Ç—Ä–∏—è, etc.)",
  "base": "Fe, Ni, Co, or Ti",

  // Additional info (in Russian)
  "application": "–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: ... (Russian text)",
  "properties": "–°–≤–æ–π—Å—Ç–≤–∞: ... (Russian text)",

  // MANDATORY: Source tracking
  "sources": [
    {{
      "url": "full URL",
      "type": "manufacturer_pdf | official_standard | verified_database | other",
      "reliability": "high | medium | low",
      "found_composition": true/false,
      "found_analogues": true/false
    }}
  ],
  "primary_source_url": "URL of the BEST source used for composition",

  // Verification metadata
  "verification": {{
    "source_count": 2,
    "agreement": "verified | partial | single_source",
    "confidence": "high | medium | low",
    "notes": ["any important notes about data quality"]
  }}
}}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
FAILURE CASES
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

If composition NOT found after searching Priority 1-4:
Return:
{{
  "grade": "{grade_name}",
  "found": false,
  "reason": "Chemical composition not found in any reliable source",
  "searched_sources": ["list of URLs checked"],
  "suggestions": ["possible alternative names or standards to check"]
}}

DO NOT return partial data without composition.
DO NOT estimate or calculate missing values.
DO NOT use unreliable sources (forums, blogs, etc.).

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ

Begin search for "{grade_name}":
"""
```

---

#### –ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–º–ø—Ç–∞

1. **–í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:**
   - –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Å ‚îÅ –¥–ª—è —á–µ—Ç–∫–∏—Ö —Å–µ–∫—Ü–∏–π
   - CRITICAL, MANDATORY –≤—ã–¥–µ–ª–µ–Ω—ã CAPS
   - –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª (STEP 1, 2, 3...)

2. **–°—Ç—Ä–æ–≥–∏–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ–∏—Å–∫–∞:**
   - Priority 1-4 —Å —è–≤–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ "STOP if found"
   - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã —Å–∞–π—Ç–æ–≤
   - –ü—Ä–∞–≤–∏–ª–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞–¥–µ–∂–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤

3. **–î–µ—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ extraction:**
   - –ß—Ç–æ –∏—Å–∫–∞—Ç—å (–Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü)
   - –ö–∞–∫ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å (range, single, max)
   - –ß—Ç–æ –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ª–∞—Ç—å (estimate, extrapolate)

4. **Cross-verification –≤—Å—Ç—Ä–æ–µ–Ω–∞:**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–∏ multiple sources
   - –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
   - Confidence scoring

5. **–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ provenance:**
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - Verification metadata
   - Confidence indicators

6. **–û–±—Ä–∞–±–æ—Ç–∫–∞ failure cases:**
   - –Ø–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —á—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –ø—Ä–∏ –Ω–µ—É–¥–∞—á–µ
   - Suggestions –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –ø–æ–∏—Å–∫–∞
   - –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (–∫–∞–∫–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã)

---

## –ß–∞—Å—Ç—å 3: –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

### 3.1 –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —É–ª—É—á—à–µ–Ω–∏–π

#### –§–∞–∑–∞ 1: Quick Wins (1-2 –Ω–µ–¥–µ–ª–∏)

**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å UX –±–µ–∑ –º–∞—Å—à—Ç–∞–±–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ.

**–ó–∞–¥–∞—á–∏:**

1. ‚úÖ **–ò–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ"**
   - Web: –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–æ Telegram –±–æ—Ç
   - Telegram: –ë–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ
   - –í—Ä–µ–º—è: 2 —á–∞—Å–∞

2. ‚úÖ **Tooltips –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏**
   - –ö–Ω–æ–ø–∫–∞ üîç - tooltip "–¢–æ—á–Ω—ã–π –ø–æ–∏—Å–∫"
   - –§–∏–ª—å—Ç—Ä—ã - –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
   - –í—Ä–µ–º—è: 1 —á–∞—Å

3. ‚úÖ **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏**
   - Web: –°–ø–∏–Ω–Ω–µ—Ä –ø—Ä–∏ –ø–æ–∏—Å–∫–µ
   - Telegram: –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –í—Ä–µ–º—è: 2 —á–∞—Å–∞

4. ‚úÖ **–£–ª—É—á—à–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é (–º–µ–Ω–µ–µ —Å—Ç—Ä–æ–≥–∞—è)**
   - –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏
   - –ù–µ –æ—Ç–∫–ª–æ–Ω—è—Ç—å –ø—Ä–∏ –Ω–µ–ø–æ–ª–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –í—Ä–µ–º—è: 3 —á–∞—Å–∞

5. ‚úÖ **Database optimizations**
   - –î–æ–±–∞–≤–∏—Ç—å timeout –∏ WAL mode
   - –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã
   - –í—Ä–µ–º—è: 2 —á–∞—Å–∞

**–ò—Ç–æ–≥–æ –§–∞–∑–∞ 1:** ~10 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã

---

#### –§–∞–∑–∞ 2: Enhanced Prompts (1 –Ω–µ–¥–µ–ª—è)

**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ AI —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —á–µ—Ä–µ–∑ –ª—É—á—à–∏–µ –ø—Ä–æ–º–ø—Ç—ã.

**–ó–∞–¥–∞—á–∏:**

1. ‚úÖ **–ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–º–ø—Ç –ø–æ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å enhanced prompt –∏–∑ 2.10
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∏–∑—É–∞–ª—å–Ω—ã–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏
   - –°—Ç—Ä–æ–≥–∏–π –ø–æ—Ä—è–¥–æ–∫ –ø–æ–∏—Å–∫–∞
   - –í—Ä–µ–º—è: 4 —á–∞—Å–∞

2. ‚úÖ **–î–æ–±–∞–≤–∏—Ç—å source tracking**
   - –†–∞—Å—à–∏—Ä–∏—Ç—å JSON –æ—Ç–≤–µ—Ç (sources array)
   - Primary source URL
   - Verification metadata
   - –í—Ä–µ–º—è: 3 —á–∞—Å–∞

3. ‚úÖ **Implement confidence scoring**
   - –î–æ–±–∞–≤–∏—Ç—å ConfidenceScorer class
   - –†–∞—Å—Å—á–∏—Ç—ã–≤–∞—Ç—å scores –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
   - –í—Ä–µ–º—è: 6 —á–∞—Å–æ–≤

4. ‚úÖ **UI –¥–ª—è confidence indicators**
   - Telegram: Enhanced formatting (2.9)
   - Web: Badges –∏ —Ü–≤–µ—Ç–æ–≤–∞—è –∏–Ω–¥–∏–∫–∞—Ü–∏—è
   - –í—Ä–µ–º—è: 5 —á–∞—Å–æ–≤

5. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - 20-30 —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–∞—Ä–æ–∫
   - –°—Ä–∞–≤–Ω–∏—Ç—å —Å—Ç–∞—Ä—ã–π vs –Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç
   - –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —É–ª—É—á—à–µ–Ω–∏—è
   - –í—Ä–µ–º—è: 4 —á–∞—Å–∞

**–ò—Ç–æ–≥–æ –§–∞–∑–∞ 2:** ~22 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã

---

#### –§–∞–∑–∞ 3: Multi-Agent System (2-3 –Ω–µ–¥–µ–ª–∏)

**–¶–µ–ª—å:** –í–Ω–µ–¥—Ä–∏—Ç—å multi-agent –ø–æ–¥—Ö–æ–¥ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞.

**–ó–∞–¥–∞—á–∏:**

1. ‚úÖ **–°–æ–∑–¥–∞—Ç—å Agent framework**
   - BaseAgent class
   - Agent orchestrator
   - –í—Ä–µ–º—è: 8 —á–∞—Å–æ–≤

2. ‚úÖ **Agent 1: Source Finder**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å agent_1_find_sources()
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ 10 –º–∞—Ä–æ–∫
   - –í—Ä–µ–º—è: 6 —á–∞—Å–æ–≤

3. ‚úÖ **Agent 2: Data Extractor**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å agent_2_extract_composition()
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π extraction –∏–∑ multiple sources
   - –í—Ä–µ–º—è: 8 —á–∞—Å–æ–≤

4. ‚úÖ **Agent 3: Verifier**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å agent_3_verify_composition()
   - Cross-verification –ª–æ–≥–∏–∫–∞
   - CompositionValidator class
   - –í—Ä–µ–º—è: 10 —á–∞—Å–æ–≤

5. ‚úÖ **Agent 4: Analogues Finder**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å agent_4_find_analogues()
   - AnaloguesVerifier class
   - –í—Ä–µ–º—è: 8 —á–∞—Å–æ–≤

6. ‚úÖ **Agent 5: Formatter**
   - –°–æ–±—Ä–∞—Ç—å –≤—Å–µ –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π JSON
   - –í—Ä–µ–º—è: 4 —á–∞—Å–∞

7. ‚úÖ **Integration & Testing**
   - –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å ai_search.py
   - Backward compatibility
   - Feature flag –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è
   - –í—Ä–µ–º—è: 10 —á–∞—Å–æ–≤

8. ‚úÖ **Comprehensive Testing**
   - 50+ —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–∞—Ä–æ–∫
   - Edge cases
   - Performance profiling
   - –í—Ä–µ–º—è: 8 —á–∞—Å–æ–≤

**–ò—Ç–æ–≥–æ –§–∞–∑–∞ 3:** ~62 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã

---

#### –§–∞–∑–∞ 4: PDF/OCR Enhancement (2 –Ω–µ–¥–µ–ª–∏)

**–¶–µ–ª—å:** –£–ª—É—á—à–∏—Ç—å –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ PDF –∏ –¥–æ–±–∞–≤–∏—Ç—å OCR.

**–ó–∞–¥–∞—á–∏:**

1. ‚úÖ **Improve PDF parser**
   - –ü–∞—Ä—Å–∏—Ç—å –¥–æ 10 —Å—Ç—Ä–∞–Ω–∏—Ü (–Ω–µ 5)
   - –ò—Å–∫–∞—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å composition
   - Extract tables
   - –í—Ä–µ–º—è: 6 —á–∞—Å–æ–≤

2. ‚úÖ **Add OCR support**
   - Tesseract integration
   - PDF ‚Üí images ‚Üí OCR
   - Fallback –¥–ª—è scanned PDFs
   - –í—Ä–µ–º—è: 8 —á–∞—Å–æ–≤

3. ‚úÖ **Table extraction & parsing**
   - –ù–∞–π—Ç–∏ composition table
   - Parse values –∏–∑ table cells
   - –í—Ä–µ–º—è: 8 —á–∞—Å–æ–≤

4. ‚úÖ **AI-enhanced extraction**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GPT-4 –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ PDF text
   - –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π extraction
   - –í—Ä–µ–º—è: 6 —á–∞—Å–æ–≤

5. ‚úÖ **Testing**
   - 20 PDF datasheets
   - Compare pdfplumber vs OCR vs AI extraction
   - –í—Ä–µ–º—è: 6 —á–∞—Å–æ–≤

**–ò—Ç–æ–≥–æ –§–∞–∑–∞ 4:** ~34 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã

---

#### –§–∞–∑–∞ 5: Spectrometer OCR (1 –Ω–µ–¥–µ–ª—è, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–¶–µ–ª—å:** –î–æ–±–∞–≤–∏—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–æ—Ç–æ —Å–ø–µ–∫—Ç—Ä–æ–º–µ—Ç—Ä–∞.

**–ó–∞–¥–∞—á–∏:**

1. ‚úÖ **GPT-4 Vision integration**
   - SpectrometerOCR class
   - Image ‚Üí composition extraction
   - –í—Ä–µ–º—è: 6 —á–∞—Å–æ–≤

2. ‚úÖ **Telegram photo handler**
   - Handle photo uploads
   - Process with OCR
   - Return matching grades
   - –í—Ä–µ–º—è: 4 —á–∞—Å–∞

3. ‚úÖ **Matching algorithm**
   - Find grades by composition
   - Tolerance ranges (¬±5-10%)
   - Ranked results
   - –í—Ä–µ–º—è: 6 —á–∞—Å–æ–≤

4. ‚úÖ **UI/UX**
   - Instructions –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - Example images
   - –í—Ä–µ–º—è: 2 —á–∞—Å–∞

5. ‚úÖ **Testing**
   - 10-15 test photos
   - Different spectrometer types
   - –í—Ä–µ–º—è: 4 —á–∞—Å–∞

**–ò—Ç–æ–≥–æ –§–∞–∑–∞ 5:** ~22 —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã

---

### 3.2 –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è

#### Must Have (–∫—Ä–∏—Ç–∏—á–Ω–æ):
- ‚úÖ –§–∞–∑–∞ 1: Quick Wins - **–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ**
- ‚úÖ –§–∞–∑–∞ 2: Enhanced Prompts - **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1**

#### Should Have (–≤–∞–∂–Ω–æ):
- ‚úÖ –§–∞–∑–∞ 3: Multi-Agent System - **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2**
- ‚úÖ –§–∞–∑–∞ 4: PDF/OCR Enhancement - **–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3**

#### Nice to Have (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- ‚ö†Ô∏è –§–∞–∑–∞ 5: Spectrometer OCR - **–µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø—Ä–æ—Å –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**

---

### 3.3 –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

#### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤ (–ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ñ–∞–∑)

```
ParserSteel/
‚îú‚îÄ‚îÄ ai_search.py                    # Main AI Search (orchestrator)
‚îÇ
‚îú‚îÄ‚îÄ ai/                             # AI modules
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îú‚îÄ‚îÄ agents/                     # Multi-agent system
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base_agent.py           # BaseAgent class
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ source_finder.py        # Agent 1
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data_extractor.py       # Agent 2
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ verifier.py             # Agent 3
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analogues_finder.py     # Agent 4
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatter.py            # Agent 5
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ prompts/                    # Prompt templates
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ enhanced_prompt.py      # Enhanced search prompt
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ source_finder_prompt.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ extractor_prompt.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ verifier_prompt.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ validators/                 # Validation logic
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ composition_validator.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analogues_verifier.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ confidence_scorer.py
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ orchestrator.py             # Multi-agent orchestration
‚îÇ
‚îú‚îÄ‚îÄ utils/                          # Utilities
‚îÇ   ‚îú‚îÄ‚îÄ pdf_parser.py               # PDF parsing (enhanced)
‚îÇ   ‚îú‚îÄ‚îÄ ocr_parser.py               # OCR for scanned PDFs
‚îÇ   ‚îú‚îÄ‚îÄ spectrometer_ocr.py         # Spectrometer image OCR
‚îÇ   ‚îî‚îÄ‚îÄ logger.py                   # Centralized logging
‚îÇ
‚îú‚îÄ‚îÄ telegram_bot/
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ search.py               # Enhanced with confidence UI
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ photo.py                # NEW: Photo handler
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îî‚îÄ‚îÄ formatters/                 # NEW: Response formatting
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îî‚îÄ‚îÄ confidence_formatter.py # Format with confidence indicators
‚îÇ
‚îî‚îÄ‚îÄ config/                         # Unified config
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ api_config.py               # API keys, endpoints
    ‚îú‚îÄ‚îÄ search_config.py            # Search settings
    ‚îî‚îÄ‚îÄ feature_flags.py            # Enable/disable features
```

---

#### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Feature Flags

```python
# config/feature_flags.py
class FeatureFlags:
    """Feature flags for gradual rollout"""

    # AI Search
    ENABLE_AI_SEARCH = True
    ENABLE_MULTI_AGENT = False  # Toggle multi-agent system
    ENABLE_PDF_ENHANCED = False  # Enhanced PDF parsing
    ENABLE_OCR = False            # OCR for scanned PDFs
    ENABLE_SPECTROMETER_OCR = False  # Spectrometer photo recognition

    # Search behavior
    ENABLE_AI_CACHE = False       # AI result caching (currently disabled)
    AI_CACHE_TTL = 86400          # 24 hours

    # Validation
    STRICT_VALIDATION = False     # If True, reject incomplete data
    REQUIRE_COMPOSITION = True    # Must have chemical composition

    # Confidence
    SHOW_CONFIDENCE_SCORES = True # Show confidence in UI
    MIN_CONFIDENCE_THRESHOLD = 0.5  # Reject if below

    # Rate limiting
    ENABLE_RATE_LIMITING = False
    MAX_AI_REQUESTS_PER_HOUR = 20

    @classmethod
    def is_enabled(cls, feature: str) -> bool:
        """Check if feature is enabled"""
        return getattr(cls, feature, False)
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```python
# ai_search.py
from config.feature_flags import FeatureFlags

def search_steel(self, grade_name: str):
    if FeatureFlags.ENABLE_MULTI_AGENT:
        return self._search_multi_agent(grade_name)
    else:
        return self._search_single_prompt(grade_name)
```

---

### 3.4 –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

#### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

**–ü–æ—Å–ª–µ –§–∞–∑—ã 1 (Quick Wins):**
- ‚úÖ UX: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–Ω–∏–º–∞—é—Ç, —á—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ "–Ω–µ –Ω–∞–π–¥–µ–Ω–æ"
- ‚úÖ Performance: SQLite –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ concurrent access
- ‚úÖ Validation: –ú–µ–Ω—å—à–µ –ª–æ–∂–Ω—ã—Ö –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–π (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å warnings)

**–ü–æ—Å–ª–µ –§–∞–∑—ã 2 (Enhanced Prompts):**
- üéØ **Accuracy:** +15-20% —Ç–æ—á–Ω–æ—Å—Ç—å extraction
- üéØ **Source Quality:** 80%+ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–∑ Tier 1-2 –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- üéØ **Completeness:** 90%+ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º —Ö–∏–º–∏—á–µ—Å–∫–∏–º —Å–æ—Å—Ç–∞–≤–æ–º
- üéØ **Confidence Transparency:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç reliability –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

**–ü–æ—Å–ª–µ –§–∞–∑—ã 3 (Multi-Agent):**
- üéØ **Accuracy:** +25-30% —Ç–æ—á–Ω–æ—Å—Ç—å (–ø–æ —Å—Ä–∞–≤–Ω–µ–Ω–∏—é —Å —Ç–µ–∫—É—â–µ–π)
- üéØ **Cross-verification:** 60%+ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã –∏–∑ 2+ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- üéØ **Confidence High:** 70%+ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Å high confidence
- üéØ **Analogues Quality:** –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö vs composition-based

**–ü–æ—Å–ª–µ –§–∞–∑—ã 4 (PDF/OCR):**
- üéØ **PDF Coverage:** 90%+ PDF datasheets —É—Å–ø–µ—à–Ω–æ –ø–∞—Ä—Å—è—Ç—Å—è
- üéØ **Scanned PDFs:** OCR fallback —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è —Å–∫–∞–Ω–æ–≤
- üéØ **Table Extraction:** 85%+ composition tables –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–ü–æ—Å–ª–µ –§–∞–∑—ã 5 (Spectrometer OCR):**
- üéØ **Photo Recognition:** 80%+ —Ñ–æ—Ç–æ —Å–ø–µ–∫—Ç—Ä–æ–º–µ—Ç—Ä–æ–≤ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è
- üéØ **Matching:** –ü–æ–∏—Å–∫ –ø–æ —Å–æ—Å—Ç–∞–≤—É —Å ¬±5-10% tolerance
- üéØ **UX:** –ù–æ–≤—ã–π use case –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (—Ñ–æ—Ç–æ ‚Üí –º–∞—Ä–∫–∞)

---

#### –°—Ä–∞–≤–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞

| –ú–µ—Ç—Ä–∏–∫–∞ | –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ | –ü–æ—Å–ª–µ –§–∞–∑—ã 2 | –ü–æ—Å–ª–µ –§–∞–∑—ã 3 | –ü–æ—Å–ª–µ –§–∞–∑—ã 4 |
|---------|-------------------|--------------|--------------|--------------|
| **–¢–æ—á–Ω–æ—Å—Ç—å extraction** | 70% | 85% | 95% | 97% |
| **–ü–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö** | 60% | 90% | 95% | 98% |
| **Confidence scores** | –ù–µ—Ç | –î–∞ (basic) | –î–∞ (advanced) | –î–∞ (advanced) |
| **Cross-verification** | –ù–µ—Ç | –ß–∞—Å—Ç–∏—á–Ω–æ | –î–∞ (2+ sources) | –î–∞ (2+ sources) |
| **PDF support** | –ë–∞–∑–æ–≤—ã–π | –ë–∞–∑–æ–≤—ã–π | –ë–∞–∑–æ–≤—ã–π | –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π+OCR |
| **Source tracking** | –ù–µ—Ç | –î–∞ | –î–∞ | –î–∞ |
| **Analogues quality** | 50% | 70% | 85% | 85% |
| **–í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞** | 20-30 —Å–µ–∫ | 25-35 —Å–µ–∫ | 40-60 —Å–µ–∫ | 45-70 —Å–µ–∫ |
| **–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞** | $0.01-0.02 | $0.02-0.03 | $0.05-0.08 | $0.06-0.10 |

**–í—ã–≤–æ–¥:** –ü–æ–≤—ã—à–µ–Ω–∏–µ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∑–∞ —Å—á–µ—Ç —É–≤–µ–ª–∏—á–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –∏ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –ø–æ–∏—Å–∫–∞. –ù–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –°–£–©–ï–°–¢–í–ï–ù–ù–û –±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω—ã–º–∏.

---

### 3.5 –†–∏—Å–∫–∏ –∏ –º–∏—Ç–∏–≥–∞—Ü–∏—è

#### –†–∏—Å–∫ 1: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–∏—Å–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** Multi-agent –ø–æ–¥—Ö–æ–¥ = –º–Ω–æ–∂–µ—Å—Ç–≤–æ API –≤—ã–∑–æ–≤–æ–≤ = –º–µ–¥–ª–µ–Ω–Ω–µ–µ.

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è agents (asyncio)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- ‚úÖ Feature flag –¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è multi-agent
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å progress bar –≤ Telegram

---

#### –†–∏—Å–∫ 2: –£–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å—Ç–æ–∏–º–æ—Å—Ç–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ–ª—å—à–µ API –≤—ã–∑–æ–≤–æ–≤ = –±–æ–ª—å—à–µ —Ä–∞—Å—Ö–æ–¥–æ–≤.

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- ‚úÖ Rate limiting (max 20 requests/hour/user)
- ‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (24 —á–∞—Å–∞ TTL)
- ‚úÖ Use cheaper models –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤
- ‚úÖ Batch processing –¥–ª—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –º–∞—Ä–æ–∫

---

#### –†–∏—Å–∫ 3: –°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞:** Multi-agent —Å–∏—Å—Ç–µ–º–∞ —Å–ª–æ–∂–Ω–µ–µ single-prompt.

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- ‚úÖ –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (docstrings)
- ‚úÖ Unit tests –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ
- ‚úÖ Feature flags –¥–ª—è rollback

---

#### –†–∏—Å–∫ 4: API rate limits

**–ü—Ä–æ–±–ª–µ–º–∞:** Perplexity/OpenAI –º–æ–≥—É—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å requests/min.

**–ú–∏—Ç–∏–≥–∞—Ü–∏—è:**
- ‚úÖ Exponential backoff –ø—Ä–∏ rate limit errors
- ‚úÖ Queue system –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ Fallback –Ω–∞ cached results
- ‚úÖ Alternative API keys (rotation)

---

### 3.6 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

#### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# utils/logger.py
import logging
import json
from datetime import datetime

class AISearchLogger:
    """Structured logging for AI Search"""

    def __init__(self, log_file='logs/ai_search.log'):
        self.logger = logging.getLogger('ai_search')
        self.logger.setLevel(logging.INFO)

        handler = logging.FileHandler(log_file)
        formatter = logging.Formatter(
            '%(asctime)s - %(name)s - %(levelname)s - %(message)s'
        )
        handler.setFormatter(formatter)
        self.logger.addHandler(handler)

    def log_search(self, grade_name: str, result: dict, metadata: dict):
        """Log AI search with structured data"""
        log_entry = {
            'timestamp': datetime.now().isoformat(),
            'grade': grade_name,
            'found': result.get('found', False),
            'confidence': result.get('confidence_score', {}).get('score'),
            'source_count': len(result.get('sources', [])),
            'primary_source_type': result.get('sources', [{}])[0].get('type') if result.get('sources') else None,
            'agent_version': metadata.get('agent_version', 'v1'),
            'duration_ms': metadata.get('duration_ms'),
            'api_calls': metadata.get('api_calls', 1),
            'cost_usd': metadata.get('cost_usd', 0.02)
        }

        self.logger.info(json.dumps(log_entry, ensure_ascii=False))

    def log_error(self, grade_name: str, error: Exception, metadata: dict):
        """Log search errors"""
        log_entry = {
            'timestamp': datetime.now().isoformat(),
            'grade': grade_name,
            'error_type': type(error).__name__,
            'error_message': str(error),
            'agent_version': metadata.get('agent_version', 'v1')
        }

        self.logger.error(json.dumps(log_entry, ensure_ascii=False))
```

---

#### Metrics Dashboard (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π dashboard –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –º–µ—Ç—Ä–∏–∫:

```python
# utils/metrics.py
class AISearchMetrics:
    """Collect and report AI Search metrics"""

    def __init__(self):
        self.metrics = {
            'total_searches': 0,
            'successful_searches': 0,
            'failed_searches': 0,
            'avg_confidence': [],
            'avg_duration_ms': [],
            'total_api_calls': 0,
            'total_cost_usd': 0.0,
            'source_types': {},
            'error_types': {}
        }

    def record_search(self, result: dict, metadata: dict):
        """Record search metrics"""
        self.metrics['total_searches'] += 1

        if result.get('found'):
            self.metrics['successful_searches'] += 1
            confidence = result.get('confidence_score', {}).get('score', 0)
            self.metrics['avg_confidence'].append(confidence)
        else:
            self.metrics['failed_searches'] += 1

        self.metrics['avg_duration_ms'].append(metadata.get('duration_ms', 0))
        self.metrics['total_api_calls'] += metadata.get('api_calls', 1)
        self.metrics['total_cost_usd'] += metadata.get('cost_usd', 0.02)

        # Track source types
        primary_source = result.get('sources', [{}])[0].get('type') if result.get('sources') else 'unknown'
        self.metrics['source_types'][primary_source] = self.metrics['source_types'].get(primary_source, 0) + 1

    def get_summary(self) -> dict:
        """Get metrics summary"""
        return {
            'total_searches': self.metrics['total_searches'],
            'success_rate': self.metrics['successful_searches'] / max(1, self.metrics['total_searches']),
            'avg_confidence': sum(self.metrics['avg_confidence']) / max(1, len(self.metrics['avg_confidence'])),
            'avg_duration_ms': sum(self.metrics['avg_duration_ms']) / max(1, len(self.metrics['avg_duration_ms'])),
            'total_api_calls': self.metrics['total_api_calls'],
            'total_cost_usd': self.metrics['total_cost_usd'],
            'avg_cost_per_search': self.metrics['total_cost_usd'] / max(1, self.metrics['total_searches']),
            'source_distribution': self.metrics['source_types']
        }
```

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã

1. **–¢–µ–∫—É—â–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏–π:**
   - DB + Web + Telegram –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç
   - AI Search —á–µ—Ä–µ–∑ Perplexity –¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
   - –ù–æ —Ç–æ—á–Ω–æ—Å—Ç—å –∏ –ø–æ–ª–Ω–æ—Ç–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã

2. **–ì–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –ø—Ä–æ–º–ø—Ç—ã, –∞ –Ω–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è:**
   - API Perplexity —Ö—É–∂–µ web –≤–µ—Ä—Å–∏–∏ –∏–∑-–∑–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
   - –ù–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –∫ –ø–æ–∏—Å–∫—É –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
   - –ù–µ—Ç cross-verification

3. **Multi-agent –ø–æ–¥—Ö–æ–¥ - –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:**
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á –ø–æ–≤—ã—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ
   - –ö–∞–∂–¥—ã–π –∞–≥–µ–Ω—Ç —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç—Å—è –Ω–∞ —Å–≤–æ–µ–π –∑–∞–¥–∞—á–µ
   - Confidence scoring —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º

4. **PDF/OCR –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è —Ä–µ–¥–∫–∏—Ö –º–∞—Ä–æ–∫:**
   - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–∏ –ø—É–±–ª–∏–∫—É—é—Ç –¥–∞–Ω–Ω—ã–µ –≤ PDF
   - –ù—É–∂–Ω–æ —É–º–µ—Ç—å –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏–∑ PDF tables
   - OCR –¥–ª—è —Å–∫–∞–Ω–æ–≤ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

5. **–ü–æ—ç—Ç–∞–ø–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫–∏:**
   - –§–∞–∑–∞ 1: Quick wins (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)
   - –§–∞–∑–∞ 2: Enhanced prompts (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
   - –§–∞–∑–∞ 3: Multi-agent (–µ—Å–ª–∏ –§–∞–∑–∞ 2 –Ω–µ –¥–∞–µ—Ç –Ω—É–∂–Ω–æ–≥–æ quality leap)
   - –§–∞–∑–∞ 4-5: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

---

### –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?

**–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (—ç—Ç–∞ –Ω–µ–¥–µ–ª—è):**
1. –í–Ω–µ–¥—Ä–∏—Ç—å –§–∞–∑—É 1 (Quick Wins) - 10 —á–∞—Å–æ–≤
2. –ù–∞—á–∞—Ç—å –§–∞–∑—É 2 (Enhanced Prompts) - –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –ø—Ä–æ–º–ø—Ç

**–ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (2-4 –Ω–µ–¥–µ–ª–∏):**
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å –§–∞–∑—É 2
2. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ 50+ –º–∞—Ä–∫–∞—Ö
3. –°–æ–±—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ (accuracy, completeness, confidence)
4. –†–µ—à–∏—Ç—å: –Ω—É–∂–Ω–∞ –ª–∏ –§–∞–∑–∞ 3 (multi-agent) –∏–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ enhanced prompts

**–°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω—ã–µ (1-2 –º–µ—Å—è—Ü–∞):**
1. –ï—Å–ª–∏ –§–∞–∑–∞ 2 –¥–∞–ª–∞ +20-25% accuracy ‚Üí –§–∞–∑–∞ 4 (PDF/OCR)
2. –ï—Å–ª–∏ –§–∞–∑–∞ 2 –¥–∞–ª–∞ <15% improvement ‚Üí –§–∞–∑–∞ 3 (multi-agent) –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞
3. –°–æ–±—Ä–∞—Ç—å feedback –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Telegram –±–æ—Ç–∞

**–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (3-6 –º–µ—Å—è—Ü–µ–≤):**
1. Spectrometer OCR (–µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–ø—Ä–æ—Å)
2. Automatic database enrichment (AI –Ω–∞—Ö–æ–¥–∏—Ç –º–∞—Ä–∫–∏ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
3. Multi-language support (English, German, etc.)

---

### –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–í–æ–ø—Ä–æ—Å—ã –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç—É:**
- –°–æ–∑–¥–∞—Ç—å Issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
- –ò–ª–∏ —Å–≤—è–∑–∞—Ç—å—Å—è —Å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–º

**–î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-01-09

**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0

---

**–ö–æ–Ω–µ—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞**
